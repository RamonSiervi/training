<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PERSONAL ‚Äî Final</title>
  <style>
    :root{
      --bg: #f7f8fb;
      --fg: #11151a;
      --muted:#5f6b7a;
      --glass: rgba(255,255,255,.55);
      --card: rgba(255,255,255,.6);
      --shadow: 0 10px 30px rgba(20,20,40,.08);
      --brand:#4f8cff; /* acento */
      --ok:#18b27a;   /* conclu√≠do */
      --warn:#ffb020;
      --section-1: rgba(79,140,255,.10);
      --section-2: rgba(121,214,173,.10);
      --section-3: rgba(255,177,193,.12);
      --section-4: rgba(167,139,250,.12);
    }
    html[data-theme="dark"]{
      --bg: #0c0f14;
      --fg: #e9eef6;
      --muted:#a4b0bf;
      --glass: rgba(18,20,25,.55);
      --card: rgba(22,25,32,.6);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --brand:#7fb0ff;
      --ok:#29d19a;
      --warn:#ffd06b;
      --section-1: rgba(79,140,255,.16);
      --section-2: rgba(121,214,173,.16);
      --section-3: rgba(255,177,193,.18);
      --section-4: rgba(167,139,250,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--fg);
      overflow-x:hidden;
    }

    /* Fundo: aquarela + bolhas leves (muito leve/perf) */
    .bg-canvas{position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none}
    .blob{position:absolute; filter: blur(40px); opacity:.45; border-radius:50%; mix-blend-mode:multiply; animation: float 18s ease-in-out infinite}
    .blob.one{background:#9fd3ff; width:420px; height:420px; top:-80px; left:-60px}
    .blob.two{background:#b6f5de; width:500px; height:500px; right:-120px; top:10%}
    .blob.three{background:#ffd6e3; width:380px; height:380px; left:30%; bottom:-140px}
    @keyframes float{ 0%,100%{transform:translateY(0) translateX(0)} 50%{transform:translateY(-18px) translateX(10px)} }

    /* Header */
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(14px) saturate(140%);
      background: var(--glass); border-bottom:1px solid rgba(255,255,255,.12);
    }
    .bar{max-width:1100px; margin:0 auto; padding:.8rem 1rem; display:flex; align-items:center; gap:.75rem}
    .avatar{width:44px; height:44px; border-radius:50%; overflow:hidden; box-shadow: var(--shadow); border:2px solid rgba(255,255,255,.6); flex:0 0 auto; cursor:pointer}
    .avatar img{width:100%; height:100%; object-fit:cover}
    .brand{font-weight:700; letter-spacing:.5px}
    .spacer{flex:1}
    .icon-btn{appearance:none; border:0; background:var(--card); padding:.55rem .7rem; border-radius:12px; box-shadow:var(--shadow); cursor:pointer; display:inline-flex; align-items:center; gap:.45rem; transition: transform .18s ease, background .2s ease, opacity .2s}
    .icon-btn:active{transform:scale(.97)}
    .icon{font-size:1.1rem}
    .only-icon{padding:.55rem}

    /* Dashboard */
    .wrap{max-width:1100px; margin:1rem auto; padding:0 1rem}
    .grid{display:grid; grid-template-columns: 1fr; gap:12px}
    @media(min-width:740px){ .grid{ grid-template-columns: 2fr 1fr } }

    .panel{background:var(--card); border-radius:18px; box-shadow:var(--shadow); backdrop-filter: blur(10px); padding:1rem}

    .summary{display:flex; align-items:center; gap:1rem}
    .ring{width:54px; height:54px; border-radius:50%; display:grid; place-items:center; background: conic-gradient(var(--ok) var(--progress,20%), rgba(127,127,127,.15) 0)}
    .ring span{background:var(--bg); color:var(--fg); border-radius:50%; width:40px;height:40px; display:grid; place-items:center; font-weight:700}
    .summary small{color:var(--muted)}

    /* Se√ß√µes */
    .section{border-radius:16px; overflow:hidden; box-shadow:var(--shadow)}
    .section + .section{margin-top:12px}
    .section-header{display:flex; align-items:center; justify-content:space-between; padding:.9rem 1rem; cursor:pointer; user-select:none}
    .section-title{display:flex; align-items:center; gap:.6rem; font-weight:700}
    .section-meta{color:var(--muted); font-size:.85rem}
    .toggle{width:28px; height:28px; display:grid; place-items:center; border-radius:10px; background:rgba(0,0,0,.06); transition: transform .25s ease}
    html[data-theme="dark"] .toggle{background:rgba(255,255,255,.06)}
    .toggle.open{transform:rotate(180deg)}
    .section-body{display:none; padding: .5rem 1rem 1rem 1rem; animation: accordion .35s ease}
    @keyframes accordion{ from{opacity:0; transform: translateY(-4px)} to{opacity:1; transform: translateY(0)} }

    .section.q{background:var(--section-1)}
    .section.pg{background:var(--section-2)}
    .section.ptb{background:var(--section-3)}
    .section.oc{background:var(--section-4)}

    /* Cards */
    .card{background:var(--card); border-radius:14px; padding:12px; box-shadow:var(--shadow); position:relative; transition: transform .2s ease, box-shadow .2s ease}
    .card + .card{margin-top:10px}
    .card:hover{transform:translateY(-2px)}
    .card-head{display:flex; align-items:start; gap:10px;}
    .vthumb{flex: 0 0 120px; border-radius:10px; overflow:hidden; aspect-ratio:16/9; background:rgba(0,0,0,.12)}
    .vthumb video{width:100%; height:100%; object-fit:cover}
    .ctitle{font-weight:700}
    .cmeta{color:var(--muted); font-size:.9rem; margin-top:2px}
    .actions{display:flex; align-items:center; gap:6px; margin-top:8px}
    .chip{font-size:.8rem; padding:.25rem .5rem; border-radius:999px; background:rgba(127,127,127,.12)}

    .complete-btn{margin-left:auto}
    .complete-btn button{border:0; border-radius:999px; padding:.45rem .7rem; background:rgba(24,178,122,.12); color:var(--ok); cursor:pointer; transition: transform .18s ease}
    .complete-btn button:active{transform:scale(.97)}
    .card.completed{outline:2px solid color-mix(in oklab, var(--ok) 60%, transparent); box-shadow:0 0 0 3px rgba(24,178,122,.15), var(--shadow)}

    /* Timer mini */
    .timer{display:inline-flex; gap:6px; align-items:center}
    .timer select,.timer button{border:0; border-radius:8px; background:rgba(127,127,127,.12); padding:.3rem .45rem; color:inherit}

    /* Mini player flutuante */
    .floating{position: fixed; right:12px; bottom:12px; width:260px; aspect-ratio:16/9; z-index:30; border-radius:12px; overflow:hidden; box-shadow:var(--shadow); background:#000; display:none}
    .floating header{position:absolute; top:6px; left:6px; right:6px; display:flex; justify-content:space-between; background:rgba(0,0,0,.35); border-radius:10px; backdrop-filter: blur(6px); padding:4px}
    .drag-handle{cursor:grab; color:#fff; font-size:.85rem}
    .floating video{width:100%; height:100%; object-fit:cover}

    /* Toast */
    .toast{position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:var(--card); color:var(--fg); padding:.65rem .9rem; border-radius:12px; box-shadow:var(--shadow); opacity:0; pointer-events:none}
    .toast.show{opacity:1; animation: fade 2.2s ease}
    @keyframes fade{0%{opacity:0; transform:translateX(-50%) translateY(10px)} 10%,90%{opacity:1; transform:translateX(-50%) translateY(0)} 100%{opacity:0} }

    /* Upload modal */
    dialog{border:0; border-radius:16px; padding:0; background:var(--card); box-shadow:var(--shadow)}
    .modal{padding:1rem; width:min(520px, 92vw)}
    .drop{border:2px dashed rgba(127,127,127,.35); border-radius:14px; padding:1rem; text-align:center}
    .drop.drag{background:rgba(127,127,127,.08)}

    /* Assistente minimal */
    .coach{position:fixed; bottom:84px; right:14px; z-index:5}
    .coach .icon-btn{border-radius:999px}

  </style>
</head>
<body>
  <div class="bg-canvas" aria-hidden="true">
    <div class="blob one"></div>
    <div class="blob two"></div>
    <div class="blob three"></div>
  </div>

  <header>
    <div class="bar">
      <label class="avatar" title="Trocar foto de perfil">
        <img id="avatarImg" src="https://via.placeholder.com/96" alt="Perfil" />
        <input id="avatarInput" type="file" accept="image/*" hidden />
      </label>
      <div class="brand">PERSONAL</div>
      <div class="spacer"></div>
      <button class="icon-btn only-icon" id="btnTheme" title="Alternar tema" aria-label="Alternar tema"><span class="icon">üåó</span></button>
      <button class="icon-btn only-icon" id="btnReset" title="Resetar conclu√≠dos" aria-label="Resetar conclu√≠dos">‚ôªÔ∏è</button>
      <button class="icon-btn" id="btnUploadOpen" title="Enviar foto"><span class="icon">üì∑</span><span class="label">Enviar</span></button>
    </div>
  </header>

  <main class="wrap">
    <section class="panel" aria-live="polite">
      <div class="summary">
        <div class="ring" id="ring"><span id="doneCount">0</span></div>
        <div>
          <div style="font-weight:700">Treinos conclu√≠dos</div>
          <small id="weekCopy">Vamos come√ßar o seu dia üëü</small>
        </div>
      </div>
    </section>

    <section class="grid">
      <div>
        <!-- Se√ß√µes de treino (todas fechadas) -->
        <article class="section q">
          <div class="section-header" data-target="#sec-q">
            <div class="section-title">‚ûï <span>Treino de Quadr√≠ceps</span></div>
            <div class="section-meta">toque para expandir <div class="toggle" aria-hidden="true">Ôºã</div></div>
          </div>
          <div id="sec-q" class="section-body"></div>
        </article>

        <article class="section pg">
          <div class="section-header" data-target="#sec-pg">
            <div class="section-title">‚ûï <span>Posterior & Gl√∫teo</span></div>
            <div class="section-meta">toque para expandir <div class="toggle" aria-hidden="true">Ôºã</div></div>
          </div>
          <div id="sec-pg" class="section-body"></div>
        </article>

        <article class="section ptb">
          <div class="section-header" data-target="#sec-ptb">
            <div class="section-title">‚ûï <span>Peito, Tr√≠ceps & B√≠ceps</span></div>
            <div class="section-meta">toque para expandir <div class="toggle" aria-hidden="true">Ôºã</div></div>
          </div>
          <div id="sec-ptb" class="section-body"></div>
        </article>

        <article class="section oc">
          <div class="section-header" data-target="#sec-oc">
            <div class="section-title">‚ûï <span>Ombro & Costas</span></div>
            <div class="section-meta">toque para expandir <div class="toggle" aria-hidden="true">Ôºã</div></div>
          </div>
          <div id="sec-oc" class="section-body"></div>
        </article>
      </div>

      <aside>
        <div class="panel" id="assistantPanel">
          <div style="font-weight:700; margin-bottom:.4rem">Assistente</div>
          <small class="muted">Dicas r√°pidas aparecer√£o aqui durante o treino.</small>
        </div>
      </aside>
    </section>
  </main>

  <!-- Floating mini player -->
  <div class="floating" id="mini">
    <header>
      <div class="drag-handle">Arraste</div>
      <div>
        <button class="icon-btn only-icon" id="miniBack" title="Voltar ao card">‚Ü©Ô∏è</button>
        <button class="icon-btn only-icon" id="miniClose" title="Fechar">‚úñÔ∏è</button>
      </div>
    </header>
    <div id="miniSlot"></div>
  </div>

  <!-- Upload modal -->
  <dialog id="uploadDialog">
    <form id="uploadForm" class="modal" method="POST" enctype="multipart/form-data">
      <h3 style="margin:0 0 .6rem 0">Enviar foto do treino</h3>
      <div class="drop" id="dropZone">
        <p>Arraste e solte uma imagem aqui, ou clique para escolher.</p>
        <input type="file" name="photo" id="photoInput" accept="image/*" style="display:none" required />
      </div>
      <label style="display:block; margin:.8rem 0 .3rem">Observa√ß√µes</label>
      <textarea name="message" rows="3" style="width:100%; border:0; border-radius:10px; background:rgba(127,127,127,.12); padding:.6rem; color:inherit"></textarea>
      <div style="display:flex; justify-content:flex-end; gap:.6rem; margin-top:1rem">
        <button type="button" class="icon-btn" id="btnCancelUp">Cancelar</button>
        <button type="submit" class="icon-btn" id="btnSendUp">Enviar</button>
      </div>
    </form>
  </dialog>

  <div class="coach">
    <button class="icon-btn only-icon" id="coachBtn" title="Dica r√°pida">üí°</button>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    /********************
     * Dados dos treinos *
     ********************/
    const TREINOS = {
      quadriceps: [
        { t:"Agachamento Sum√¥ com Halteres", s:"S√©ries: 3x10/10/10 (Drop ‚Äì tudo conta como 1 s√©rie)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-sumo-squat-front.mp4" },
        { t:"Leg Press 45", s:"S√©ries: 4x15 p√©s colados + 15 afastados", carga:"12kg", intervalo:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-leg-press-front.mp4" },
        { t:"Adu√ß√£o de Quadril M√°quina", s:"S√©ries: 3x10/10/10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-adduction-front.mp4" },
        { t:"Cadeira Flexora", s:"S√©ries: 3x10/10/10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-seated-leg-curl-side.mp4" },
        { t:"Cadeira Flexora Unilateral", s:"S√©ries: 3x10/10/10/10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Seated_Leg_Curl_FR_1080.mp4" },
        { t:"Panturrilha no Step", s:"S√©ries: 4x15", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-calves-stretch-variation-3-side.mp4" },
        { t:"Abdominal Canivete", s:"S√©ries: 4x15", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-suitcase-crunch-side.mp4" },
        { t:"Esteira Caminhada", s:"S√©rie: 30 reps", carga:"‚Äî", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4" },
      ],
      posterior: [
        { t:"Agachamento com Halteres", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-rack-squat-side.mp4" },
        { t:"Abdu√ß√£o de Quadril M√°quina", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-abduction-front.mp4" },
        { t:"El√≠ptico", s:"S√©ries: 25 reps", carga:"0kg", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-elliptical-side.mp4" },
        { t:"Afundo com Barra Livre", s:"S√©ries: 3x12, 3x10, 2x8", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-barbell-reverse-lunge-side.mp4" },
        { t:"Agachamento Sum√¥ no Step", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/DB_Sumo_Squat_FR_1080.mp4" },
        { t:"Abdu√ß√£o de Quadril M√°quina", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Hip_Abduction_FR_1080.mp4" },
        { t:"Cadeira Extensora", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-leg-extension-side.mp4" },
        { t:"Cadeira Extensora Unilateral", s:"S√©ries: 3x10+10+10 (Drop)", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Single_Leg_Extension_FR_1080.mp4" },
        { t:"Leg Press 45 Unilateral", s:"S√©ries: 3x12, 3x10, 2x8", carga:"0kg", intervalo:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Leg_Press_FR_1080.mp4" }
      ],
      peito: [
        { t:"Alongamento de Ombros e Tr√≠ceps II", s:"S√©ries: 3x20", carga:"0kg", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-shoulders-stretch-variation-1-front.mp4" },
        { t:"Bike Spinning Sentada", s:"S√©ries: 40 reps", carga:"‚Äî", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-stationary-bike-side.mp4" },
        { t:"Abdominal Supra Solo", s:"S√©ries: 5x15", carga:"0kg", intervalo:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/Crunch_FR_1080.mp4" },
        { t:"Tr√≠ceps Unilateral Polia Alta (Neutra)", s:"S√©ries: 3x15", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4" },
        { t:"Alongamento de Peitoral Espaldar", s:"S√©ries: 3x15", carga:"0kg", intervalo:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-chest-stretch-variation-1-side.mp4" },
        { t:"Mobilidade de Ombro III", s:"S√©rie: 3x20", carga:"0kg", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4" },
        { t:"Rosca Alternada com Halteres", s:"S√©ries: 3x15", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-curl-side.mp4" },
        { t:"Tr√≠ceps na Polia com Corda", s:"S√©ries: 3x15 Lento + 15 Curto", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-push-down-side.mp4" },
        { t:"Tr√≠ceps Unilateral Polia Alta (Neutra)", s:"S√©ries: 3x15", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4" },
        { t:"Crucifixo com Halteres", s:"S√©ries: 4x12", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-fly-front.mp4" },
        { t:"Crucifixo Inclinado com Halteres", s:"S√©ries: 4x12", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-flys-side.mp4" },
        { t:"Rosca Martelo com Halteres", s:"S√©ries: 4x12", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-hammer-curl-side.mp4" }
      ],
      ombro: [
        { t:"Puxada alta (neutra)", s:"S√©ries: 3x10/8/6 (Drop)", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4" },
        { t:"Abdominal Canivete", s:"S√©ries: 3x12", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/V_Up_FR_1080.mp4" },
        { t:"Esteira Caminhada", s:"S√©ries: 40 reps", carga:"‚Äî", intervalo:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4" },
        { t:"Eleva√ß√£o Lateral Unilateral Sentado", s:"S√©ries: 3x10/8/6 (Drop)", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-seated-overhead-press-front.mp4" },
        { t:"Eleva√ß√£o Frontal Alternada", s:"S√©ries: 3x12", carga:"4‚Äì6kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-raise-side.mp4" },
        { t:"Desenvolvimento com Halteres (neutra)", s:"S√©ries: 3x10/8/6 (Drop)", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/Neutral_Grip_DB_Press_FR_1080.mp4" },
        { t:"Remada Baixa Tri√¢ngulo", s:"S√©ries: 3x10/8/6 (Drop)", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/cables/_1080/Seated_Row_V_Grip_FR_1080.mp4" },
        { t:"Remada Baixa Frente", s:"S√©ries: 3x10/8/6 (Drop)", carga:"0kg", intervalo:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-seated-cable-row-front.mp4" }
      ]
    };

    /*****************
     * Utilidades UI *
     *****************/
    const $ = (q,root=document)=>root.querySelector(q);
    const $$= (q,root=document)=>Array.from(root.querySelectorAll(q));

    const toast = (msg)=>{ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2200)}
    const vibrate = (p)=>{ if(navigator.vibrate) try{ navigator.vibrate(p) }catch(_){} }

    // Tema: manual via toggle
    const THEME_KEY = 'pf_theme';
    const setTheme = (mode)=>{ document.documentElement.setAttribute('data-theme', mode); localStorage.setItem(THEME_KEY, mode) }
    const initTheme = ()=>{ const saved=localStorage.getItem(THEME_KEY) || 'light'; setTheme(saved) }

    // Done counter
    const DONE_KEY = 'pf_done_ids';
    const getDone = ()=> new Set(JSON.parse(localStorage.getItem(DONE_KEY)||'[]'))
    const setDone = (set)=> localStorage.setItem(DONE_KEY, JSON.stringify([...set]))

    // Build card
    function cardTpl(ex, id){
      const div=document.createElement('div');
      div.className='card';
      div.dataset.id = id;
      div.innerHTML = `
        <div class="card-head">
          <div class="vthumb"><video preload="none" playsinline muted controlslist="nodownload noplaybackrate" src="${ex.v}" loading="lazy"></video></div>
          <div class="ctxt">
            <div class="ctitle">${ex.t}</div>
            <div class="cmeta">${ex.s} ¬∑ Carga: ${ex.carga}</div>
            <div class="actions">
              <span class="chip">Intervalo:</span>
              <div class="timer">
                <select>
                  <option value="30">30s</option>
                  <option value="40">40s</option>
                  <option value="60">60s</option>
                </select>
                <button class="tStart" type="button">‚ñ∂Ô∏é</button>
                <button class="tStop" type="button">‚ñ†</button>
                <span class="tLeft" aria-live="polite"></span>
              </div>
              <div class="complete-btn"><button type="button">Concluir</button></div>
            </div>
          </div>
        </div>`;
      return div;
    }

    // Render sections
    function render(){
      const secQ = $('#sec-q'), secPG=$('#sec-pg'), secPTB=$('#sec-ptb'), secOC=$('#sec-oc');
      const lists=[TREINOS.quadriceps, TREINOS.posterior, TREINOS.peito, TREINOS.ombro];
      const targets=[secQ,secPG,secPTB,secOC];
      const done=getDone();
      let gid=0;
      lists.forEach((arr, idx)=>{
        targets[idx].innerHTML='';
        arr.forEach(ex=>{
          const id = `${idx}-${gid++}`;
          const c = cardTpl(ex,id);
          if(done.has(id)) c.classList.add('completed');
          targets[idx].appendChild(c);
        })
      })
      updateProgress();
    }

    function updateProgress(){
      const total = $$('.card').length;
      const done  = $$('.card.completed').length;
      $('#doneCount').textContent = done;
      const pct = total? Math.round(done/total*100) : 0;
      $('#ring').style.setProperty('--progress', pct+'%');
      $('#weekCopy').textContent = done? `Muito bom! ${done} conclu√≠do(s).` : 'Vamos come√ßar o seu dia üëü';
    }

    // Section toggles
    function bindSections(){
      $$('.section-header').forEach(h=>{
        h.addEventListener('click',()=>{
          const body = $(h.dataset.target);
          const tg = h.querySelector('.toggle');
          const plusText = h.querySelector('.section-title');
          const isOpen = body.style.display==='block';
          body.style.display = isOpen? 'none':'block';
          tg.classList.toggle('open', !isOpen);
          // mini anima√ß√£o do +/‚àí
          plusText.firstChild.textContent = isOpen? '‚ûï':'‚ûñ';
        })
      })
    }

    // Complete + timer + video handlers + mini-player
    let timerHandle=null, timerLeft=0, tSpan=null;
    function bindCards(){
      $$('.card').forEach(card=>{
        const doneBtn = $('.complete-btn button', card);
        const video = $('video', card);
        const tStart=$('.tStart', card), tStop=$('.tStop', card); tSpan=$('.tLeft', card);
        const sel=$('select', card);

        doneBtn.addEventListener('click', ()=>{
          card.classList.toggle('completed');
          const set = getDone();
          const id = card.dataset.id;
          if(card.classList.contains('completed')) set.add(id); else set.delete(id);
          setDone(set); updateProgress();
          vibrate([25]);
          toast(card.classList.contains('completed')? '‚úÖ Exerc√≠cio conclu√≠do' : '‚Ü©Ô∏è Desmarcado');
        })

        tStart.addEventListener('click', ()=>{
          const secs = parseInt(sel.value,10) || 30; timerLeft=secs; tSpan.textContent = secs+'s';
          clearInterval(timerHandle);
          timerHandle = setInterval(()=>{
            timerLeft--; tSpan.textContent = timerLeft+'s';
            if(timerLeft<=5) vibrate([60]);
            if(timerLeft<=0){ clearInterval(timerHandle); tSpan.textContent=''; toast('‚è±Ô∏è Intervalo conclu√≠do'); vibrate([120,60,120]); }
          }, 1000);
        })
        tStop.addEventListener('click', ()=>{ clearInterval(timerHandle); tSpan.textContent=''; })

        // PiP/mini player: mover v√≠deo para o container quando sai do viewport
        const io = new IntersectionObserver(([e])=>{
          if(!document.body.contains(video)) { io.disconnect(); return; }
          if(!e.isIntersecting && !$('#mini').contains(video) && !video.paused){ toMini(video, card) }
        }, {threshold:.1});
        io.observe(video);
      })
    }

    // Drag mini
    function draggable(el){
      let x=0,y=0, ox=0, oy=0, dragging=false;
      const header=$('#mini header');
      header.addEventListener('pointerdown', (ev)=>{ dragging=true; header.setPointerCapture(ev.pointerId); ox=ev.clientX; oy=ev.clientY; const r=el.getBoundingClientRect(); x=r.left; y=r.top })
      header.addEventListener('pointermove', (ev)=>{ if(!dragging) return; const dx=ev.clientX-ox, dy=ev.clientY-oy; el.style.left=(x+dx)+'px'; el.style.top=(y+dy)+'px'; el.style.right='auto'; el.style.bottom='auto' })
      header.addEventListener('pointerup', ()=> dragging=false)
    }

    const mini=$('#mini'), miniSlot=$('#miniSlot');
    let origin={ parent:null, next:null };
    function toMini(video, card){
      origin.parent = video.parentElement; origin.next = video.nextSibling;
      mini.style.display='block'; miniSlot.appendChild(video);
      video.controls = true; vibrate([20]);
      toast('üì∫ Mini player ativo');
      draggable(mini);
      $('#miniBack').onclick = ()=>{
        if(origin.parent){ origin.parent.insertBefore(video, origin.next); mini.style.display='none'; }
      };
      $('#miniClose').onclick = ()=>{ video.pause(); if(origin.parent){ origin.parent.insertBefore(video, origin.next) } mini.style.display='none'; };
    }

    // Reset
    $('#btnReset').addEventListener('click', ()=>{
      localStorage.removeItem(DONE_KEY);
      $$('.card.completed').forEach(c=>c.classList.remove('completed'));
      updateProgress(); toast('üîÑ Progresso resetado');
    })

    // Theme toggle manual
    initTheme();
    $('#btnTheme').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme');
      setTheme(cur==='light'?'dark':'light');
    })

    // Upload modal + Formspree fix
    const dlg=$('#uploadDialog');
    $('#btnUploadOpen').addEventListener('click', ()=>{ dlg.showModal() })
    $('#btnCancelUp').addEventListener('click', ()=> dlg.close())

    const zone=$('#dropZone'); const input=$('#photoInput');
    zone.addEventListener('click', ()=> input.click())
    zone.addEventListener('dragover', e=>{ e.preventDefault(); zone.classList.add('drag') })
    zone.addEventListener('dragleave', ()=> zone.classList.remove('drag'))
    zone.addEventListener('drop', e=>{ e.preventDefault(); zone.classList.remove('drag'); if(e.dataTransfer.files[0]){ input.files = e.dataTransfer.files; }} )

    const FORMSPREE_ENDPOINT = 'https://formspree.io/f/mzzavnrq';
    $('#uploadForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.currentTarget);
      // Enviar para formspree via fetch
      try{
        const r = await fetch(FORMSPREE_ENDPOINT, { method:'POST', body: fd, headers: { 'Accept':'application/json' } });
        if(r.ok){ toast('‚úÖ Enviado com sucesso'); dlg.close(); e.currentTarget.reset(); }
        else{ toast('‚ö†Ô∏è Falha no envio'); }
      }catch(err){ toast('‚ö†Ô∏è Erro de rede'); }
    })

    // Avatar local (n√£o envia, apenas troca visual + persiste no localStorage)
    const AVATAR_KEY='pf_avatar';
    const avIn=$('#avatarInput'), avImg=$('#avatarImg');
    const stored=localStorage.getItem(AVATAR_KEY); if(stored) avImg.src=stored;
    $('.avatar').addEventListener('click', ()=> avIn.click());
    avIn.addEventListener('change', ()=>{
      const f=avIn.files[0]; if(!f) return; const fr=new FileReader(); fr.onload=()=>{ avImg.src=fr.result; localStorage.setItem(AVATAR_KEY, fr.result); toast('üñºÔ∏è Foto de perfil atualizada') }; fr.readAsDataURL(f);
    })

    // Assistente dicas leves
    const tips=[
      'Mantenha o core ativo durante o agachamento.',
      'Respire: desce inspirando, sobe expirando.',
      'Postura primeiro, carga depois.',
      'Controle o movimento na volta (fase exc√™ntrica).'
    ];
    $('#coachBtn').addEventListener('click', ()=>{
      const t = tips[Math.floor(Math.random()*tips.length)];
      $('#assistantPanel').innerHTML = `<div style="font-weight:700; margin-bottom:.4rem">Assistente</div><small>${t}</small>`;
      toast('üí° Dica aplicada');
    })

    // Init
    render();
    bindSections();
    bindCards();
  </script>
</body>
</html>
