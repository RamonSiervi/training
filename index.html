<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Treinos</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f7fb;
    --glass: rgba(255,255,255,.6);
    --stroke: rgba(0,0,0,.06);
    --text:#1b1b1d;
    --muted:#6b6f76;
    --accent:#1f7aec;
    --success:#15b56b;
    --warning:#ffb020;
    --danger:#ff5a7a;
    --shadow: 0 10px 30px rgba(30,35,55,.08);
    --radius: 16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"Sora",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background: var(--bg);
    color: var(--text);
  }

  /* Header glass */
  header{
    position:sticky;top:0;z-index:50;
    backdrop-filter: blur(10px);
    background: rgba(255,255,255,.55);
    border-bottom:1px solid var(--stroke);
    box-shadow: 0 6px 20px rgba(0,0,0,.05);
  }
  .bar{
    max-width:1100px;margin:0 auto;
    display:flex;align-items:center;gap:14px;
    padding:14px 18px;
  }
  .spacer{flex:1}

  /* Bot√£o/link Dieta com efeito (n√£o √© t√≠tulo) */
  .btn-dieta{
    position:relative;
    font-weight:800;
    font-size:20px;
    letter-spacing:.4px;
    text-decoration:none;
    padding:6px 12px;
    border-radius:12px;
    display:inline-flex;align-items:center;gap:10px;
    isolation:isolate;
  }
  .btn-dieta .label{
    background: linear-gradient(90deg,#2e2e2f,#3c3d3f,#5a5c60,#2e2e2f);
    background-size:200% 100%;
    -webkit-background-clip:text;
    background-clip:text;
    -webkit-text-fill-color:transparent;
    animation: gradientShift 8s linear infinite;
    text-shadow: 0 2px 4px rgba(0,0,0,.12);
  }
  .btn-dieta::after{
    content:"";
    position:absolute; inset:0;
    border-radius:12px;
    background: radial-gradient(120px 40px at var(--x,0%) 50%, rgba(255,255,255,.35), transparent 60%);
    mix-blend-mode: screen;
    pointer-events:none;
  }
  .btn-dieta:hover{filter:saturate(1.05)}
  .btn-dieta:active{transform: translateY(1px)}

  @keyframes gradientShift{0%{background-position:0% 50%}100%{background-position:200% 50%}}

  /* Buttons top */
  .icon-btn{
    display:inline-flex;align-items:center;justify-content:center;
    width:38px;height:38px;border-radius:12px;border:1px solid var(--stroke);
    background: var(--glass);
    box-shadow: var(--shadow);
    cursor:pointer;
    transition:.2s ease;
  }
  .icon-btn:hover{transform:translateY(-1px)}
  .icon-btn:active{transform:translateY(0)}

  /* Assistente indicador */
  .icon-assist[data-state="on"]{outline:2px solid rgba(21,181,107,.25)}
  .icon-assist[data-state="text"]{outline:2px solid rgba(31,122,236,.25)}
  .icon-assist[data-state="off"]{opacity:.65}

  /* Container principal */
  .wrap{max-width:1100px;margin:22px auto;padding:0 18px 60px}

  /* Toolbar se√ß√£o */
  .section{
    background: var(--glass);
    border:1px solid var(--stroke);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom:20px;
    overflow:hidden;
  }
  .section-header{
    display:flex;align-items:center;gap:10px;
    padding:14px 16px;
    cursor:pointer;
    user-select:none;
  }
  .section-title{font-weight:700}
  .counter{font-weight:600;color:var(--muted);margin-left:auto}

  .toggle{width:28px;height:28px;border-radius:10px;border:1px solid var(--stroke);display:grid;place-items:center;background:rgba(255,255,255,.6)}
  .toggle span{font-size:16px;line-height:1}

  .section-body{padding:6px 14px 16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
  .card{
    position:relative;
    background: rgba(255,255,255,0.72);
    border:1px solid var(--stroke);
    border-radius: 16px;
    box-shadow: var(--shadow);
    padding:12px;
    overflow:hidden;
    transition: transform .2s ease, box-shadow .2s ease, background .3s ease;
  }
  .card:hover{transform:translateY(-2px); box-shadow:0 14px 34px rgba(0,0,0,.08)}
  .card.completed{background: rgba(245,255,249,.86)}
  .card .title{font-weight:700;margin:2px 0 6px;font-size:14px}
  .meta{color:var(--muted);font-size:12px;margin:0 0 8px}

  /* Video */
  .vid-wrap{position:relative;border-radius:12px;overflow:hidden}
  video{
    width:100%;height:auto;display:block;
  }
  .vid-overlay{
    position:absolute;inset:0;display:grid;place-items:center;
    background: rgba(0,0,0,.0);
    opacity:0; transition: opacity .2s ease, background .25s ease;
    pointer-events:none;
  }
  .vid-wrap.paused .vid-overlay{opacity:1;background:rgba(0,0,0,.18)}
  .vid-icon{
    width:62px;height:62px;border-radius:50%;display:grid;place-items:center;
    background: rgba(255,255,255,.9); border:1px solid var(--stroke); box-shadow: var(--shadow);
    font-size:22px;
  }

  .row{display:flex;align-items:center;gap:8px;margin-top:10px}
  .btn{
    padding:8px 10px;border-radius:10px;border:1px solid var(--stroke);
    background:rgba(255,255,255,.8);box-shadow:var(--shadow);cursor:pointer;
    font-weight:600;font-size:12px;
  }
  .btn:active{transform:translateY(1px)}

  .btn-intervalo{display:inline-flex;align-items:center;gap:6px}
  .btn-concluir{display:inline-flex;align-items:center;gap:6px;background:rgba(21,181,107,.12);border-color:rgba(21,181,107,.25)}

  /* Temporizador flutuante dentro do card */
  .timer{
    position:absolute;inset:0;display:none;align-items:center;justify-content:center;
    background: rgba(255,255,255,.86); backdrop-filter: blur(4px);
  }
  .timer.on{display:flex}
  .timer-circle{
    width:140px;height:140px;border-radius:50%;
    background: conic-gradient(var(--accent) var(--deg,0deg), rgba(0,0,0,.08) 0);
    display:grid;place-items:center;
    transition: filter .3s ease;
  }
  .timer.paused .timer-circle{filter: saturate(.5)}
  .timer-num{font-weight:800;font-size:26px;color:#222}

  /* Toast fila */
  .toast{
    position:fixed;left:16px;bottom:16px;z-index:80;pointer-events:none;
    display:flex;flex-direction:column;gap:8px;
  }
  .toast .item{
    pointer-events:auto;
    background: rgba(255,255,255,.94);
    border:1px solid var(--stroke);
    box-shadow: var(--shadow);
    border-radius: 14px;
    padding:10px 12px;font-size:13px;color:#222;
    animation: pop .25s ease;
    display:flex;align-items:center;gap:8px;
  }
  @keyframes pop{from{transform:translateY(6px);opacity:0}to{transform:translateY(0);opacity:1}}

  /* Painel da assistente */
  .panel{
    position:fixed;right:16px;bottom:16px;z-index:70;
    background: rgba(255,255,255,.92);border:1px solid var(--stroke);box-shadow: var(--shadow);
    border-radius:16px;padding:12px;min-width:240px;display:none;
  }
  .panel.show{display:block}
  .panel h4{margin:0 0 8px}
  .panel .opt{display:flex;gap:8px}
  .panel .opt button{flex:1}

  /* Indicador visual sutil no canto */
  .indicator{
    position:fixed;left:12px;bottom:72px;width:10px;height:10px;border-radius:999px;
    background: #8aa0b8; opacity:.35; box-shadow:0 0 0 0 rgba(31,122,236,.35);
    transition:.3s;
  }
  .indicator.talking{
    opacity:.9; box-shadow:0 0 0 10px rgba(31,122,236,.0);
    animation: pulse 1.4s ease infinite;
  }
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(31,122,236,.35)}70%{box-shadow:0 0 0 12px rgba(31,122,236,0)}100%{box-shadow:0 0 0 0 rgba(31,122,236,0)}}

  /* Expandir/Recolher global */
  .top-controls{display:flex;align-items:center;gap:10px}

  /* Discreto: micro feedback concluir */
  .ripple{
    position:absolute;inset:-2px;border-radius:16px;pointer-events:none;
    background: radial-gradient(600px 80px at 50% -10%, rgba(21,181,107,.22), transparent 70%);
    opacity:0;transition:.4s;
  }
  .card.completed .ripple{opacity:1}

  /* Esconde setinhas redundantes originais: agora s√≥ √≠cone concluir circular */
  .done-dot{
    width:28px;height:28px;border-radius:999px;border:1px solid rgba(21,181,107,.25);
    background: rgba(21,181,107,.12);display:grid;place-items:center;font-size:14px;cursor:pointer;
  }

  /* Acessibilidade touch */
  @media (hover:none){
    .icon-btn:hover{transform:none}
    .card:hover{transform:none}
  }
</style>
</head>
<body>
  <header onmousemove="event.target.closest('.btn-dieta') && event.target.closest('.btn-dieta').style.setProperty('--x', (event.offsetX/this.offsetWidth*100)+'%')">
    <div class="bar">
      <button class="icon-btn" id="toggleAll" title="Expandir/Recolher se√ß√µes">Ôºã</button>
      <div class="spacer"></div>

      <a class="btn-dieta" href="dieta.html" title="Abrir Dieta">
        <span class="label">Dieta</span>
      </a>

      <div class="top-controls">
        <button class="icon-btn" id="btnReset" title="Reset">‚ü≤</button>
        <button class="icon-btn icon-assist" id="btnAssist" data-state="on" title="Assistente">üí°</button>
      </div>
    </div>
  </header>

  <div class="wrap" id="app"></div>

  <!-- Toasts -->
  <div class="toast" id="toast"></div>
  <!-- Painel assistente -->
  <div class="panel" id="panel">
    <h4>Assistente</h4>
    <div class="opt">
      <button class="btn" data-mode="on">Texto + Voz</button>
      <button class="btn" data-mode="text">S√≥ Texto</button>
      <button class="btn" data-mode="off">Off</button>
    </div>
    <small style="display:block;margin-top:8px;color:var(--muted)">
      A assistente inicia ligada. O estado fica salvo no navegador.
    </small>
  </div>
  <!-- Indicador sutil -->
  <div class="indicator" id="indicator"></div>

<script>
/* =========================
   DADOS DOS TREINOS + V√çDEOS
   ========================= */
const SECOES = [
  {
    titulo: "Posterior & Gl√∫teo",
    itens: [
      { t:"Agachamento Sum√¥ com Halteres", meta:"S√©rie: 3x10/10/10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-sumo-squat-front.mp4" },
      { t:"Leg Press 45", meta:"S√©rie: 4x15 (p√©s juntos) + 15 (afastados) | Carga: 12kg | Intervalo: 40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-leg-press-front.mp4" },
      { t:"Adu√ß√£o de Quadril M√°quina", meta:"S√©rie: 3x10/10/10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-adduction-front.mp4" },
      { t:"Cadeira Flexora", meta:"S√©ries: 3x10/10/10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-seated-leg-curl-side.mp4" },
      { t:"Cadeira Flexora (alt)", meta:"S√©ries: 3x10/10/10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Seated_Leg_Curl_FR_1080.mp4" },
      { t:"Panturrilha no Step", meta:"S√©rie: 4x15 | Carga: 0kg | Intervalo: 30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-calves-stretch-variation-3-side.mp4" },
      { t:"Abdominal Canivete", meta:"S√©rie: 4x15 | Carga: 0kg | Intervalo: 30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-suitcase-crunch-side.mp4" },
      { t:"Esteira Caminhada", meta:"S√©rie: 30 reps", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4" },
    ]
  },
  {
    titulo: "Quadric√≠pes",
    itens: [
      { t:"Agachamento com Halteres", meta:"S√©rie: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-rack-squat-side.mp4" },
      { t:"Abdu√ß√£o de Quadril M√°quina", meta:"S√©ries: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-abduction-front.mp4" },
      { t:"El√≠ptico", meta:"S√©ries: 25reps | Carga: 0kg", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-elliptical-side.mp4" },
      { t:"Afundo com Barra Livre", meta:"S√©ries: 3x12 3x10 2x8 | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-barbell-reverse-lunge-side.mp4" },
      { t:"Agachamento Sum√¥ no Step com Halteres", meta:"S√©ries: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/DB_Sumo_Squat_FR_1080.mp4" },
      { t:"Abdu√ß√£o de Quadril M√°quina (alt)", meta:"S√©ries: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Hip_Abduction_FR_1080.mp4" },
      { t:"Cadeira Extensora", meta:"S√©ries: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-leg-extension-side.mp4" },
      { t:"Cadeira Extensora Unilateral", meta:"S√©ries: 3x10+10+10 (Drop) | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Single_Leg_Extension_FR_1080.mp4" },
      { t:"Leg Press 45 Unilateral", meta:"S√©ries: 3x12 3x10 2x8 | Carga: 0kg | Intervalo: 60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Leg_Press_FR_1080.mp4" },
    ]
  },
  {
    titulo: "Peito, Tr√≠ceps e B√≠ceps",
    itens: [
      { t:"Alongamento de Ombros e Tr√≠ceps II", meta:"S√©ries: 3x20 | Carga: 0kg", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-shoulders-stretch-variation-1-front.mp4" },
      { t:"Bike Spinning Sentada", meta:"S√©ries: 40 reps", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-stationary-bike-side.mp4" },
      { t:"Abdominal Supra Solo", meta:"S√©ries: 5x15 | Carga:0kg | Intervalo: 40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/Crunch_FR_1080.mp4" },
      { t:"Tr√≠ceps Unilateral na Polia Alta (Pegada Neutra)", meta:"S√©ries: 3x15 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4" },
      { t:"Alongamento de Peitoral (Espaldar)", meta:"S√©ries 3x15 | Carga:0kg | Intervalo: 40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-chest-stretch-variation-1-side.mp4" },
      { t:"Mobilidade de Ombro III", meta:"S√©rie: 3x20 | Carga: 0kg", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4" },
      { t:"Rosca Alternada com Halteres", meta:"S√©ries: 3x15 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-curl-side.mp4" },
      { t:"Tr√≠ceps na Polia com Corda", meta:"S√©ries: 3x15 Lento + 15 curto | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-push-down-side.mp4" },
      { t:"Crucifixo com Halteres", meta:"S√©ries: 4x12 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-fly-front.mp4" },
      { t:"Crucifixo Inclinado com Halteres", meta:"S√©ries: 4x12 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-flys-side.mp4" },
      { t:"Rosca Martelo com Halteres", meta:"S√©ries: 4x12 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-hammer-curl-side.mp4" }
    ]
  },
  {
    titulo: "Ombro e Costas",
    itens: [
      { t:"Desenvolvimento com Halteres (Pegada Neutra)", meta:"S√©ries: 3x10/8/6 (Drop) | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-neutral-overhead-press-side.mp4" },
      { t:"Abdominal Canivete", meta:"S√©ries: 3x12 | Carga:0kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/V-Up_FR_1080.mp4" },
      { t:"Esteira Caminhada", meta:"S√©ries: 40 reps", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4" },
      { t:"Eleva√ß√£o Lateral Unilateral Sentado", meta:"S√©ries: 3x10/8/6 (Drop) | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-seated-overhead-press-front.mp4" },
      { t:"Eleva√ß√£o Frontal Alternada", meta:"S√©ries: 3x12 | Carga: 4 a 6kg | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-raise-side.mp4" },
      { t:"Puxada alta (pegada neutra)", meta:"S√©ries: 3x10/8/6 (Drop) | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/Neutral_Grip_DB_Press_FR_1080.mp4" },
      { t:"Remada Baixa Tri√¢ngulo", meta:"S√©ries: 3x10/8/6 (Drop) | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/cables/_1080/Seated_Row_V_Grip_FR_1080.mp4" },
      { t:"Remada Baixa (alt)", meta:"S√©ries: 3x10/8/6 (Drop) | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-seated-cable-row-front.mp4" },
      { t:"Puxada Aberta Barra Reta", meta:"S√©ries: 3x10/8/6 (Drop) | Intervalo:30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4" }
    ]
  }
];

/* =========================
   RENDER
   ========================= */
const app = document.getElementById('app');
let expandidas = true;
function el(tag, attrs={}, ...children){
  const e = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{
    if(k==='class') e.className=v;
    else if(k==='html') e.innerHTML=v;
    else if(k.startsWith('on')) e.addEventListener(k.slice(2), v);
    else e.setAttribute(k,v);
  });
  children.forEach(c=> e.appendChild(typeof c==='string'? document.createTextNode(c): c));
  return e;
}

function render(){
  app.innerHTML='';
  SECOES.forEach((sec,si)=>{
    const section = el('div',{class:'section', 'data-index':si});
    const header = el('div',{class:'section-header'});
    const toggle = el('div',{class:'toggle'}, el('span',{}, expandidas?'‚àí':'Ôºã'));
    const title = el('div',{class:'section-title'}, document.createTextNode(sec.titulo));
    const counter = el('div',{class:'counter', id:`counter-${si}`}, document.createTextNode('(0/'+sec.itens.length+')'));
    header.append(toggle,title,counter);
    section.appendChild(header);

    const body = el('div',{class:'section-body', style: expandidas?'':'display:none'});
    sec.itens.forEach((it, idx)=>{
      const card = el('div',{class:'card', 'data-si':si, 'data-i':idx});

      const ripple = el('div',{class:'ripple'});
      const title = el('div',{class:'title'}, document.createTextNode(it.t));
      const meta = el('div',{class:'meta'}, document.createTextNode(it.meta));

      const vidWrap = el('div',{class:'vid-wrap paused'});
      const video = el('video',{src:it.v, preload:"metadata", playsinline:"", disablepictureinpicture:""});
      // 20% maior (mant√©m largura do card; os cards est√£o dimensionados responsivos)
      // Play/Pause ao clique
      video.addEventListener('click', ()=>{
        if(video.paused){ video.play(); vidWrap.classList.remove('paused'); }
        else { video.pause(); vidWrap.classList.add('paused'); }
      });
      video.addEventListener('play', ()=> vidWrap.classList.remove('paused'));
      video.addEventListener('pause', ()=> vidWrap.classList.add('paused'));

      const overlay = el('div',{class:'vid-overlay'}, el('div',{class:'vid-icon'}, document.createTextNode('‚ñ∂')));
      vidWrap.append(video, overlay);

      const row = el('div',{class:'row'});
      const btnInter = el('button',{class:'btn btn-intervalo'}, document.createTextNode('Intervalo 60s'));
      const done = el('div',{class:'done-dot', title:'Concluir'}, document.createTextNode('‚úì'));
      row.append(btnInter, done);

      // Temporizador
      const timer = el('div',{class:'timer'});
      const circle = el('div',{class:'timer-circle'});
      const num = el('div',{class:'timer-num'}, document.createTextNode('00:00'));
      circle.appendChild(num); timer.appendChild(circle);

      // A√ß√µes
      let completed = false;
      done.addEventListener('click', ()=>{
        completed = !completed;
        card.classList.toggle('completed', completed);
        saveProgress();
        updateCounter(si);
        toast(completed? '‚úÖ Exerc√≠cio conclu√≠do' : '‚Ü© Marcado como n√£o conclu√≠do');
      });

      // Temporizador comportamento
      let duration = parseInt((it.meta.match(/Intervalo:\s*(\d+)s/i)||[])[1] || '60', 10);
      btnInter.textContent = `Intervalo ${duration}s`;
      let startAt=0, remain=duration, ticking=false, rafId=null;

      function tick(ts){
        if(!startAt) startAt = ts;
        const elapsed = (ts - startAt)/1000;
        const left = Math.max(0, remain - elapsed);
        const deg = (1 - left/duration)*360;
        circle.style.setProperty('--deg', deg+'deg');
        num.textContent = fmt(left);
        if(left>0 && ticking){ rafId = requestAnimationFrame(tick); }
        else if(left<=0){
          ticking=false; timer.classList.remove('paused');
          vibrate5();
          playEndTone();
          setTimeout(()=> hideTimer(), 600);
        }
      }
      function fmt(s){
        const m = Math.floor(s/60), ss = Math.floor(s%60);
        return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
      }
      function showTimer(){
        timer.classList.add('on'); timer.classList.remove('paused');
        // inicia automaticamente
        startAt=0; remain=duration; ticking=true; rafId=requestAnimationFrame(tick);
      }
      function hideTimer(){ timer.classList.remove('on'); cancelAnimationFrame(rafId); ticking=false; }
      function pauseTimer(){ ticking=false; timer.classList.add('paused'); remain = Math.max(0, remain - ((performance.now()-startAt)/1000)); }
      function resumeTimer(){ ticking=true; timer.classList.remove('paused'); startAt=0; rafId=requestAnimationFrame(tick); }

      btnInter.addEventListener('click', ()=>{
        showTimer();
      });

      timer.addEventListener('click', ()=>{
        if(!timer.classList.contains('on')) return;
        if(ticking){ pauseTimer(); }
        else if(remain>0){ resumeTimer(); }
      });

      // Montagem
      card.append(ripple, title, meta, vidWrap, row, timer);
      body.appendChild(card);
    });

    header.addEventListener('click', ()=>{
      const shown = body.style.display !== 'none';
      body.style.display = shown ? 'none' : '';
      syncGlobalToggle();
    });

    section.appendChild(body);
    app.appendChild(section);
  });
}
render();

/* =========================
   Expandir/Recolher global sincronizado
   ========================= */
const toggleAll = document.getElementById('toggleAll');
function syncGlobalToggle(){
  const bodies = [...document.querySelectorAll('.section-body')];
  const allHidden = bodies.every(b=> b.style.display==='none');
  const allShown  = bodies.every(b=> b.style.display!== 'none');
  toggleAll.textContent = allHidden ? 'Ôºã' : (allShown ? '‚àí' : '¬±');
}
toggleAll.addEventListener('click', ()=>{
  const bodies = [...document.querySelectorAll('.section-body')];
  const allHidden = bodies.every(b=> b.style.display==='none');
  bodies.forEach(b=> b.style.display = allHidden ? '' : 'none');
  syncGlobalToggle();
});
syncGlobalToggle();

/* =========================
   Contadores de se√ß√£o e progresso persistente
   ========================= */
function updateCounter(si){
  const sec = document.querySelector(`.section[data-index="${si}"]`);
  const cards = sec.querySelectorAll('.card');
  const done = sec.querySelectorAll('.card.completed').length;
  const total = cards.length;
  sec.querySelector(`#counter-${si}`).textContent = `(${done}/${total})`;
}
function saveProgress(){
  const done = [...document.querySelectorAll('.card')].map(c=> c.classList.contains('completed')?1:0);
  localStorage.setItem('progress', JSON.stringify(done));
}
function loadProgress(){
  const raw = localStorage.getItem('progress'); if(!raw) return;
  const arr = JSON.parse(raw);
  document.querySelectorAll('.card').forEach((c,i)=>{
    if(arr[i]) c.classList.add('completed');
  });
  // counters
  document.querySelectorAll('.section').forEach((s,si)=> updateCounter(si));
}
window.addEventListener('load', ()=> setTimeout(loadProgress, 0));

/* =========================
   Assistente Minimalista (PT-BR)
   ========================= */
const btnAssist = document.getElementById('btnAssist');
const indicator = document.getElementById('indicator');
const panel = document.getElementById('panel');
const toastBox = document.getElementById('toast');

const MENSAGENS = [
  "üíß N√£o esque√ßa de beber √°gua.",
  "‚ú® Postura: coluna neutra e core firme.",
  "‚è±Ô∏è Controle o ritmo, sem pressa.",
  "üßò Respire pelo nariz, solte pela boca.",
  "üëè Excelente! Continue constante.",
  "ü¶µ Foque na amplitude com seguran√ßa.",
  "üî• √öltimas repeti√ß√µes fazem a diferen√ßa.",
  "üìè T√©cnica primeiro, carga depois."
];

let assistMode = localStorage.getItem('assistMode') || 'on';
applyAssistMode(assistMode);
btnAssist.addEventListener('click', ()=>{
  panel.classList.toggle('show');
});

panel.querySelectorAll('[data-mode]').forEach(b=>{
  b.addEventListener('click', ()=>{
    assistMode = b.dataset.mode;
    localStorage.setItem('assistMode', assistMode);
    applyAssistMode(assistMode);
    panel.classList.remove('show');
    toast(`Assistente: ${ assistMode==='on' ? 'Texto + Voz' : assistMode==='text' ? 'S√≥ texto' : 'Desligada' }`);
  });
});

function applyAssistMode(mode){
  btnAssist.dataset.state = mode;
}

/* Ciclo autom√°tico de sugest√µes */
let msgIndex = 0;
setInterval(()=>{
  if(assistMode==='off') return;
  const m = MENSAGENS[msgIndex];
  toast(m);
  if(assistMode==='on') speak(m); // S√≥ fala o texto (sem emojis)
  msgIndex = (msgIndex+1) % MENSAGENS.length;
}, 14000);

/* Falar apenas o texto (PT-BR, sem emojis) */
let asstVoice=null;
function initVoice(){
  const voices = speechSynthesis.getVoices();
  asstVoice = voices.find(v=> v.lang.toLowerCase().startsWith('pt-br') && /female|mulher|brasil|brazil/i.test(v.name))
            || voices.find(v=> v.lang.toLowerCase().startsWith('pt-br'))
            || voices.find(v=> v.lang.toLowerCase().startsWith('pt'))
            || null;
}
if(speechSynthesis.onvoiceschanged!==undefined){ speechSynthesis.onvoiceschanged = initVoice; }
initVoice();

function speak(msg){
  if(!('speechSynthesis' in window)) return;
  let clean = msg.replace(/[^\p{L}\p{N}\p{P}\p{Z}]/gu, ''); // remove emojis
  const u = new SpeechSynthesisUtterance(clean);
  if(asstVoice) u.voice = asstVoice;
  u.lang = 'pt-BR';
  u.pitch = 1.03;
  u.rate = 1;
  u.volume = 1;
  indicator.classList.add('talking');
  u.onend = ()=> indicator.classList.remove('talking');
  speechSynthesis.speak(u);
}

/* =========================
   Toast com fila (sem poluir)
   ========================= */
const queue = [];
let showing = false;
function toast(text){
  queue.push(text);
  if(!showing) showNext();
}
function showNext(){
  if(queue.length===0){showing=false;return;}
  showing = true;
  const t = document.createElement('div');
  t.className = 'item';
  t.textContent = queue.shift();
  toastBox.appendChild(t);
  setTimeout(()=>{
    t.style.opacity='0'; t.style.transform='translateY(6px)';
    setTimeout(()=>{ t.remove(); showNext(); }, 180);
  }, 2500);
}

/* =========================
   Reset
   ========================= */
document.getElementById('btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('.card').forEach(c=> c.classList.remove('completed'));
  saveProgress();
  document.querySelectorAll('.section').forEach((s,si)=> updateCounter(si));
  toast('Reset aplicado');
});

/* =========================
   Vibra√ß√£o 5s + Som final estilo iPhone (clean)
   ========================= */
function vibrate5(){ if('vibrate' in navigator){ navigator.vibrate([80,40,80]); } }

function playEndTone(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type='sine';
  o.frequency.value = 880; // A5
  o.connect(g); g.connect(ctx.destination);
  const now = ctx.currentTime;
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.15, now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now+0.25);
  o.start(); o.stop(now+0.26);
}

/* =========================
   Util ‚Äì Atualiza contadores ao entrar
   ========================= */
document.querySelectorAll('.section').forEach((s,si)=> updateCounter(si));

</script>
</body>
</html>
