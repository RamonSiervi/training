<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PERSONAL ‚Ä¢ Futurista</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
:root{
  --bg:#0e1018;--bg-2:#101424;--text:#e9eefc;--muted:#aab2c7;--glass:rgba(255,255,255,.06);
  --border:1px solid rgba(255,255,255,.18);--shadow:0 12px 30px rgba(0,0,0,.35);
  --acc:#67d1ff;--acc2:#835bff;--ok:#37e39f;--danger:#ff6b6b;
}
[data-theme="light"]{--bg:#f7f9ff;--bg-2:#ffffff;--text:#101418;--muted:#637088;--glass:rgba(0,0,0,.04);--border:1px solid rgba(0,0,0,.08);--shadow:0 10px 30px rgba(0,0,0,.08)}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Outfit,system-ui; color:var(--text); background:radial-gradient(1200px 600px at 120% -10%, #1b2650 0%, transparent 60%),radial-gradient(1200px 800px at -20% 110%, #121a36 0%, transparent 60%),var(--bg); overflow-x:hidden}
.wrapper{max-width:1180px;margin:0 auto;padding:20px 18px 120px}
/* PARTICLES BACKGROUND */
#fx{position:fixed;inset:0;z-index:-1}
/* NAV */
.nav{position:sticky;top:12px;z-index:20;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));backdrop-filter:blur(10px);border:var(--border);box-shadow:var(--shadow)}
.brand{display:flex;align-items:center;gap:10px}
.avatar{width:40px;height:40px;border-radius:50%;overflow:hidden;display:grid;place-items:center;background:linear-gradient(180deg,rgba(255,255,255,.2),rgba(255,255,255,.05));border:var(--border)}
.avatar img{width:100%;height:100%;object-fit:cover}
.title{font-weight:900;letter-spacing:.6px}
.nav-actions{display:flex;align-items:center;gap:8px}
.icon{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:var(--glass);border:var(--border);cursor:pointer}
.icon:hover{outline:1px solid rgba(255,255,255,.25)}
.focus-chip{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:var(--glass);border:var(--border);cursor:pointer}
/* DASH */
.dashboard{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:16px}
@media(max-width:860px){.dashboard{grid-template-columns:1fr}}
.panel{background:var(--glass);backdrop-filter:saturate(160%) blur(12px);border:var(--border);border-radius:20px;padding:16px;box-shadow:var(--shadow)}
.panel h2{margin:0 0 6px}
.muted{color:var(--muted);font-size:14px}
/* WEEK MINI SUMMARY */
.week-mini{display:flex;align-items:center;gap:10px}
.week-mini .aura{width:32px;height:32px;border-radius:50%;display:grid;place-items:center;position:relative}
.week-mini .aura:before{content:"";position:absolute;inset:-4px;border-radius:50%;border:2px solid rgba(103,209,255,.45);filter:blur(1px)}
.week-mini .count{font-weight:800}
/* HISTORY */
.carousel{display:flex;gap:10px;overflow:auto;padding:6px 2px}
.thumb{min-width:120px;height:84px;border-radius:14px;overflow:hidden;border:var(--border);background:#0f162a}
.thumb img{width:100%;height:100%;object-fit:cover}
/* SECTIONS */
.section{margin-top:16px}
.head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-radius:16px;background:linear-gradient(90deg,rgba(103,209,255,.12),rgba(255,255,255,.04));border:var(--border);cursor:pointer}
.head.green{background:linear-gradient(90deg,rgba(55,227,159,.12),rgba(255,255,255,.04))}
.head.purple{background:linear-gradient(90deg,rgba(131,91,255,.12),rgba(255,255,255,.04))}
.head.cyan{background:linear-gradient(90deg,rgba(40,214,214,.12),rgba(255,255,255,.04))}
.head .left{display:flex;align-items:center;gap:10px;font-weight:800}
.toggle{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;background:var(--glass);border:var(--border)}
.toggle i{transition:transform .35s ease}
[open] .toggle i{transform:rotate(180deg)}
.progress{height:8px;background:rgba(255,255,255,.12);border-radius:8px;overflow:hidden;min-width:160px}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--ok),#ffffff66)}
.cards{display:grid;grid-template-columns:repeat(2,minmax(260px,1fr));gap:14px;padding:14px 4px}
@media(max-width:840px){.cards{grid-template-columns:1fr}}
/* CARD */
.card{position:relative;border-radius:18px;border:var(--border);background:var(--glass);backdrop-filter:saturate(160%) blur(12px);overflow:hidden;transition:.35s cubic-bezier(.2,.6,.2,1)}
.card:hover{transform:translateY(-2px)}
.card video{width:100%;height:180px;object-fit:cover;display:block}
.content{padding:12px 14px}
.content h4{margin:0 0 6px}
.meta{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:12px;color:var(--muted)}
.meta b{color:var(--text)}
.row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
.pill{padding:8px 10px;border-radius:12px;background:rgba(255,255,255,.07);border:var(--border)}
.finish{appearance:none;width:52px;height:30px;border-radius:30px;position:relative;background:rgba(255,255,255,.14);border:var(--border);cursor:pointer}
.finish:before{content:"";position:absolute;top:3px;left:3px;width:24px;height:24px;background:#fff;border-radius:50%;transition:.25s}
.finish:checked{background:linear-gradient(90deg,#22e38f,#aaf1d2)}
.finish:checked:before{left:25px}
.card.done{outline:1px solid rgba(34,227,143,.6);box-shadow:0 0 0 3px rgba(34,227,143,.16) inset}
/* FOCUS MODE */
.focus-layer{position:fixed;inset:0;display:none;place-items:center;background:rgba(8,10,20,.55);backdrop-filter:blur(10px);z-index:60}
.focus-layer.active{display:grid}
.focus-card{width:min(720px,94%);border-radius:20px;background:var(--glass);border:var(--border);overflow:hidden}
.focus-controls{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:10px 12px}
.media-actions{display:flex;gap:8px}
.btn{padding:10px 14px;border-radius:12px;background:var(--glass);border:var(--border);color:var(--text);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--acc),#ffffff66);color:#0e1018;font-weight:800}
/* MODALS */
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(10,12,20,.55);backdrop-filter:blur(12px);z-index:70}
.modal.active{display:grid}
.dialog{width:min(560px,92%);background:var(--glass);border:var(--border);border-radius:18px;box-shadow:var(--shadow)}
.dialog header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:var(--border)}
.dialog .body{padding:14px}
/* Upload */
.drop{border:2px dashed rgba(255,255,255,.25);border-radius:14px;padding:14px;text-align:center}
.preview{display:flex;gap:10px;overflow:auto}
.preview img{height:80px;border-radius:10px}
/* Toast */
.toast{position:fixed;bottom:18px;right:18px;padding:10px 14px;border-radius:12px;background:rgba(18,28,50,.86);border:var(--border);opacity:0;transform:translateY(8px);transition:.3s;z-index:100}
.toast.show{opacity:1;transform:translateY(0)}
/* Parallax */
.card[data-tilt]{transform-style:preserve-3d}
/* Coach */
.coach{position:fixed;bottom:20px;left:20px;padding:10px 12px;border-radius:14px;background:var(--glass);border:var(--border);backdrop-filter:blur(10px);display:none;z-index:90}
.coach.show{display:block}
</style>
</head>
<body data-theme="dark">
<canvas id="fx"></canvas>
<div class="wrapper">
  <!-- NAV -->
  <div class="nav">
    <div class="brand">
      <div class="avatar" id="avatar"><img id="avatarImg" alt=""/></div>
      <div class="title">PERSONAL</div>
    </div>
    <div class="nav-actions">
      <div class="icon" id="themeBtn" title="Tema"><i class="fa-solid fa-moon"></i></div>
      <div class="icon" id="uploadBtn" title="Enviar foto"><i class="fa-solid fa-camera"></i></div>
      <div class="icon" id="resetBtn" title="Resetar"><i class="fa-solid fa-rotate"></i></div>
      <div class="focus-chip" id="focusBtn"><i class="fa-solid fa-headphones"></i><span>Modo Foco</span></div>
    </div>
  </div>

  <!-- DASHBOARD SIMPLES -->
  <div class="dashboard">
    <div class="panel">
      <h2>Resumo da semana</h2>
      <p class="muted">Minimalista, s√≥ o que importa.</p>
      <div class="week-mini">
        <div class="aura"><i class="fa-solid fa-check"></i></div>
        <div class="muted">Treinos conclu√≠dos:</div>
        <div class="count" id="weekDone">0</div>
      </div>
      <div style="margin-top:10px" class="muted">Hist√≥rico visual</div>
      <div class="carousel" id="history"></div>
    </div>
    <div class="panel">
      <h2>Se√ß√µes</h2>
      <p class="muted">Abra uma se√ß√£o e marque os exerc√≠cios como conclu√≠dos.</p>
    </div>
  </div>

  <!-- SECTIONS -->
  <div id="sections"></div>
</div>

<!-- FOCUS MODE -->
<div class="focus-layer" id="focusLayer">
  <div class="focus-card">
    <video id="focusVideo" controls playsinline style="width:100%;height:auto;max-height:60vh;background:#000"></video>
    <div class="focus-controls">
      <div id="focusTitle" style="font-weight:800"></div>
      <div class="media-actions">
        <button class="btn" id="pipBtn" title="Picture-in-Picture"><i class="fa-regular fa-square"></i></button>
        <button class="btn" id="soundBtn" title="M√∫sica ambiente"><i class="fa-solid fa-volume-high"></i></button>
      </div>
      <div>
        <button class="btn" id="focusPrev"><i class="fa-solid fa-arrow-left"></i></button>
        <button class="btn primary" id="focusNext">Pr√≥ximo</button>
        <button class="btn" id="focusClose">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- UPLOAD MODAL (LOCAL + FORMSPREE) -->
<div class="modal" id="uploadModal">
  <div class="dialog">
    <header>
      <strong>Enviar foto do treino</strong>
      <div class="icon" id="uploadClose"><i class="fa-solid fa-xmark"></i></div>
    </header>
    <div class="body">
      <div class="drop"><input id="fileInput" type="file" accept="image/*" multiple></div>
      <textarea id="note" rows="3" placeholder="Observa√ß√£o (opcional)" class="panel" style="width:100%"></textarea>
      <div class="preview" id="preview"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button class="btn" id="uploadCancel">Cancelar</button>
        <button class="btn" id="uploadLocal">Salvar local</button>
        <button class="btn primary" id="uploadSend">Enviar (Formspree)</button>
      </div>
    </div>
  </div>
</div>

<!-- RESET MODAL -->
<div class="modal" id="resetModal">
  <div class="dialog">
    <header>
      <strong>Resetar progresso</strong>
      <div class="icon" id="resetClose"><i class="fa-solid fa-xmark"></i></div>
    </header>
    <div class="body">
      <p class="muted">Isso limpar√° conclu√≠dos, hist√≥rico e estat√≠sticas locais.</p>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn" id="resetCancel">Cancelar</button>
        <button class="btn" id="resetConfirm" style="background:linear-gradient(90deg,#ff8585,#ffd1d1);color:#2b0c0f;font-weight:800">Resetar</button>
      </div>
    </div>
  </div>
</div>

<!-- COACH TIP -->
<div class="coach" id="coach">üí° Dica: fa√ßa um aquecimento r√°pido antes de iniciar!</div>

<div class="toast" id="toast"></div>

<script>
/************** DATA **************/
const TREINOS=[
 {nome:"Treino de Quadr√≠ceps", cls:"", headCls:"", colorHint:"" , it:[
  {n:"Agachamento Sum√¥ com Halteres", s:"3x10/10/10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-sumo-squat-front.mp4"},
  {n:"Leg Press 45¬∞", s:"4x15 (p√©s colados) + 15 (afastados)", c:"12 kg", i:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-leg-press-front.mp4"},
  {n:"Adu√ß√£o de Quadril M√°quina", s:"3x10/10/10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-adduction-front.mp4"},
  {n:"Cadeira Flexorad", s:"3x10/10/10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-seated-leg-curl-side.mp4"},
  {n:"Cadeira Flexora Unilateral", s:"3x10/10/10/10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Seated_Leg_Curl_FR_1080.mp4"},
  {n:"Panturrilha no Step", s:"4x15", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-calves-stretch-variation-3-side.mp4"},
  {n:"Abdominal Canivete", s:"4x15", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-suitcase-crunch-side.mp4"},
  {n:"Esteira Caminhada", s:"30 reps", c:"‚Äî", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4"}
 ]},
 {nome:"Posterior & Gl√∫teo", headCls:"purple", it:[
  {n:"Agachamento com Halteres", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-rack-squat-side.mp4"},
  {n:"Abdu√ß√£o de Quadril M√°quina", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-abduction-front.mp4"},
  {n:"El√≠ptico", s:"25 reps", c:"0 kg", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-elliptical-side.mp4"},
  {n:"Afundo com Barra Livre", s:"3x12 3x10 2x8", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-barbell-reverse-lunge-side.mp4"},
  {n:"Agachamento Sum√¥ no Step", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/DB_Sumo_Squat_FR_1080.mp4"},
  {n:"Abdu√ß√£o de Quadril (2)", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Hip_Abduction_FR_1080.mp4"},
  {n:"Cadeira Extensora", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-leg-extension-side.mp4"},
  {n:"Cadeira Extensora Unilateral", s:"3x10+10+10 (Drop ‚Äì 1)", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Single_Leg_Extension_FR_1080.mp4"},
  {n:"Leg Press 45¬∞ Unilateral", s:"3x12 3x10 2x8", c:"0 kg", i:"60s", v:"https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Leg_Press_FR_1080.mp4"}
 ]},
 {nome:"Peito, Tr√≠ceps & B√≠ceps", headCls:"green", it:[
  {n:"Alongamento Ombros & Tr√≠ceps II", s:"3x20", c:"0 kg", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-shoulders-stretch-variation-1-front.mp4"},
  {n:"Bike Spinning Sentada", s:"40 reps", c:"‚Äî", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-stationary-bike-side.mp4"},
  {n:"Abdominal Supra Solo", s:"5x15", c:"0 kg", i:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/Crunch_FR_1080.mp4"},
  {n:"Tr√≠ceps Unilateral Polia (Neutra)", s:"3x15", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4"},
  {n:"Alongamento de Peitoral Espaldar", s:"3x15", c:"0 kg", i:"40s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-chest-stretch-variation-1-side.mp4"},
  {n:"Mobilidade de Ombro III", s:"3x20", c:"0 kg", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4"},
  {n:"Rosca Alternada com Halteres", s:"3x15", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-curl-side.mp4"},
  {n:"Tr√≠ceps Polia com Corda", s:"3x15 Lento + 15 curto", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-push-down-side.mp4"},
  {n:"Crucifixo com Halteres", s:"4x12", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-fly-front.mp4"},
  {n:"Crucifixo Inclinado com Halteres", s:"4x12", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-flys-side.mp4"},
  {n:"Rosca Martelo com Halteres", s:"4x12", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-hammer-curl-side.mp4"}
 ]},
 {nome:"Ombro & Costas", headCls:"cyan", it:[
  {n:"Puxada alta (pegada neutra)", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4"},
  {n:"Abdominal Canivete", s:"3x12", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/V-Up_FR_1080.mp4"},
  {n:"Esteira Caminhada", s:"40 reps", c:"‚Äî", i:"‚Äî", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4"},
  {n:"Eleva√ß√£o Lateral Unilateral Sentado", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-seated-overhead-press-front.mp4"},
  {n:"Eleva√ß√£o Frontal Alternada", s:"3x12", c:"4‚Äì6 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-raise-side.mp4"},
  {n:"Desenvolvimento com Halteres (neutra)", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/Neutral_Grip_DB_Press_FR_1080.mp4"},
  {n:"Puxada Neutra Tri√¢ngulo", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/cables/_1080/Seated_Row_V_Grip_FR_1080.mp4"},
  {n:"Remada Baixa Tri√¢ngulo", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-seated-cable-row-front.mp4"},
  {n:"Puxada Aberta Barra Reta", s:"3x10/8/6 (Drop ‚Äì 1)", c:"0 kg", i:"30s", v:"https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4"}
 ]}
];

/************** STATE **************/
const state={done:JSON.parse(localStorage.getItem('done')||'{}'),photos:JSON.parse(localStorage.getItem('photos')||'[]'),theme:localStorage.getItem('theme')||autoTheme(),avatar:localStorage.getItem('avatar')||'',sessions:JSON.parse(localStorage.getItem('sessions')||'[]'),events:JSON.parse(localStorage.getItem('events')||'[]')};
function persist(){localStorage.setItem('done',JSON.stringify(state.done));localStorage.setItem('photos',JSON.stringify(state.photos));localStorage.setItem('theme',state.theme);localStorage.setItem('avatar',state.avatar);localStorage.setItem('sessions',JSON.stringify(state.sessions));localStorage.setItem('events',JSON.stringify(state.events));}
function autoTheme(){const h=(new Date).getHours();return (h>=7&&h<19)?'light':'dark'}

/************** PARTICLES (COSMIC FLUID) **************/
(function(){const c=document.getElementById('fx'),ctx=c.getContext('2d');let w,h,pr=window.devicePixelRatio||1;let dots=[];function resize(){w=window.innerWidth;h=window.innerHeight;c.width=w*pr;c.height=h*pr;ctx.scale(pr,pr);}window.addEventListener('resize',resize);resize();
function spawn(n){for(let i=0;i<n;i++){dots.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4,r:2+Math.random()*3,alpha:.15+.25*Math.random()});}}spawn(90);
function step(){ctx.clearRect(0,0,w,h);for(const d of dots){d.x+=d.vx;d.y+=d.vy; if(d.x<0||d.x>w) d.vx*=-1; if(d.y<0||d.y>h) d.vy*=-1; ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.fillStyle=`rgba(103,209,255,${d.alpha})`;ctx.fill();} for(let i=0;i<dots.length;i++){for(let j=i+1;j<dots.length;j++){const a=dots[i],b=dots[j];const dx=a.x-b.x,dy=a.y-b.y,dist=Math.hypot(dx,dy);if(dist<120){ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.strokeStyle=`rgba(131,91,255,${.06*(1-dist/120)})`;ctx.lineWidth=1;ctx.stroke();}}}requestAnimationFrame(step);}step();})();

/************** THEME **************/
const themeBtn=document.getElementById('themeBtn');
setTheme(state.theme); function setTheme(t){document.body.setAttribute('data-theme',t);themeBtn.innerHTML=t==='dark'?'<i class="fa-solid fa-sun"></i>':'<i class="fa-solid fa-moon"></i>';state.theme=t;persist();}
themeBtn.onclick=()=>setTheme(state.theme==='dark'?'light':'dark');

/************** AVATAR **************/
const avatar=document.getElementById('avatar');const avatarImg=document.getElementById('avatarImg');
function renderAvatar(){ if(state.avatar){avatarImg.src=state.avatar;} else {avatarImg.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="%2367d1ff"/><stop offset="100%" stop-color="%23835bff"/></linearGradient></defs><rect width="80" height="80" rx="40" fill="url(%23g)"/><circle cx="40" cy="34" r="14" fill="white" opacity=".85"/><rect x="18" y="50" width="44" height="16" rx="8" fill="white" opacity=".85"/></svg>'; }}
renderAvatar();
avatar.addEventListener('click',()=>{const i=document.createElement('input');i.type='file';i.accept='image/*';i.onchange=()=>{const f=i.files[0];if(!f) return;const r=new FileReader();r.onload=e=>{state.avatar=e.target.result;persist();renderAvatar();};r.readAsDataURL(f);};i.click();});

/************** BUILD SECTIONS **************/
const sectionsEl=document.getElementById('sections');
TREINOS.forEach((sec,si)=>{
  const S=document.createElement('section');S.className='section';S.dataset.index=si;
  const head=document.createElement('div');head.className='head '+(sec.headCls||'');head.innerHTML=`<div class="left"><div class="toggle"><i class="fa-solid fa-plus"></i></div>${sec.nome}</div><div class="progress"><span></span></div>`;
  const cards=document.createElement('div');cards.className='cards';cards.style.display='none';
  sec.it.forEach((ex,ei)=>{
    const key=`${si}-${ei}`;const done=!!state.done[key];
    const C=document.createElement('div');C.className='card'+(done?' done':'');C.setAttribute('data-tilt','');C.innerHTML=`<video src="${ex.v}" preload="none" controls playsinline></video><div class="content"><h4>${ex.n}</h4><div class="meta"><div>S√©ries <b>${ex.s}</b></div><div>Carga <b>${ex.c}</b></div><div>Intervalo <b>${ex.i}</b></div></div><div class="row"><div class="pill">Pronto?</div><label><input type="checkbox" class="finish" data-key="${key}" ${done?'checked':''}></label></div></div>`;cards.appendChild(C);
  });
  S.appendChild(head);S.appendChild(cards);sectionsEl.appendChild(S);
});

// Toggle open/close with animation and coach tip
sectionsEl.addEventListener('click',e=>{const h=e.target.closest('.head');if(!h) return;const sec=h.parentElement;const icon=h.querySelector('.toggle i');const cards=sec.querySelector('.cards');const open=sec.hasAttribute('open');if(open){sec.removeAttribute('open');icon.className='fa-solid fa-plus';cards.animate([{opacity:1},{opacity:0}],{duration:200,fill:'forwards'});setTimeout(()=>cards.style.display='none',200);}else{sec.setAttribute('open','');icon.className='fa-solid fa-minus';cards.style.display='grid';cards.animate([{opacity:0,transform:'translateY(8px)'},{opacity:1,transform:'translateY(0)'}],{duration:260,easing:'ease-out'});showCoach();}});

// Finish toggles
sectionsEl.addEventListener('change',e=>{const fin=e.target.closest('.finish');if(!fin) return;const key=fin.dataset.key;state.done[key]=fin.checked; if(!fin.checked) delete state.done[key]; persist(); fin.closest('.card').classList.toggle('done',fin.checked); toast(fin.checked?'Exerc√≠cio conclu√≠do!':'Marcado como pendente'); updateProgress(); registerEvent(fin.checked?'done':'undo'); updateWeek();});

// Progress per section
function updateProgress(){TREINOS.forEach((sec,si)=>{const total=sec.it.length;let d=0;sec.it.forEach((_,ei)=>{if(state.done[`${si}-${ei}`]) d++});const span=document.querySelector(`section[data-index="${si}"] .progress > span`);span.style.width=Math.round(d/total*100)+'%';});}

/************** PARALLAX (tilt) **************/
(function(){const max=8;sectionsEl.addEventListener('mousemove',e=>{const card=e.target.closest('.card[data-tilt]');if(!card) return;const r=card.getBoundingClientRect();const px=(e.clientX-r.left)/r.width-.5;const py=(e.clientY-r.top)/r.height-.5;card.style.transform=`rotateX(${(-py*max)}deg) rotateY(${px*max}deg)`;});sectionsEl.addEventListener('mouseleave',()=>{document.querySelectorAll('.card[data-tilt]').forEach(c=>c.style.transform='');});})();

/************** FOCUS MODE (Mobile friendly + PiP + Ambient) **************/
const focusBtn=document.getElementById('focusBtn'), focusLayer=document.getElementById('focusLayer');
const fVideo=document.getElementById('focusVideo'), fTitle=document.getElementById('focusTitle');
const pipBtn=document.getElementById('pipBtn'), soundBtn=document.getElementById('soundBtn');
const fPrev=document.getElementById('focusPrev'), fNext=document.getElementById('focusNext'), fClose=document.getElementById('focusClose');
let playlist=[],idx=0,ambient=new Audio();ambient.loop=true;ambient.src='data:audio/mp3;base64,'; // placeholder silencioso
focusBtn.onclick=()=>{playlist=TREINOS.flatMap(s=>s.it.map(i=>({t:i.n,src:i.v})));idx=0;openFocus();startSession();}
function openFocus(){focusLayer.classList.add('active');load();}
function closeFocus(){focusLayer.classList.remove('active');endSession();}
function load(){const it=playlist[idx];fVideo.src=it.src;fTitle.textContent=it.t;try{fVideo.play();}catch(_){} }
fNext.onclick=()=>{idx=(idx+1)%playlist.length;load();}
fPrev.onclick=()=>{idx=(idx-1+playlist.length)%playlist.length;load();}
fClose.onclick=closeFocus;
pipBtn.onclick=async()=>{if(document.pictureInPictureElement){document.exitPictureInPicture();return;}if('requestPictureInPicture' in HTMLVideoElement.prototype){try{await fVideo.requestPictureInPicture();}catch(e){toast('PiP n√£o dispon√≠vel');}}else toast('PiP n√£o suportado');}
soundBtn.onclick=()=>{if(ambient.paused){ambient.play().catch(()=>{});soundBtn.innerHTML='<i class="fa-solid fa-volume-xmark"></i>';}else{ambient.pause();soundBtn.innerHTML='<i class="fa-solid fa-volume-high"></i>';}}

/************** HYBRID STATS (timer interno + rel√≥gio do sistema) **************/
let sessionStart=null;function startSession(){sessionStart=Date.now();}
function endSession(){if(!sessionStart) return;const mins=Math.max(0, Math.round((Date.now()-sessionStart)/60000));state.sessions.push({t:Date.now(),m:mins});persist();updateWeek();sessionStart=null;}
function registerEvent(type){state.events.push({t:Date.now(),type});persist();}
function weekWindow(ts){const now=new Date(ts||Date.now());const start=now.getTime()-7*864e5;return {start, end:now.getTime()}}
function updateWeek(){const w=weekWindow();const done=state.events.filter(e=>e.type==='done'&&e.t>=w.start).length;document.getElementById('weekDone').textContent=done;}
updateWeek();

/************** UPLOAD (LOCAL + FORMSPREE) **************/
const uploadBtn=document.getElementById('uploadBtn');const uploadModal=document.getElementById('uploadModal');
const uploadClose=document.getElementById('uploadClose');const uploadCancel=document.getElementById('uploadCancel');
const uploadLocal=document.getElementById('uploadLocal');const uploadSend=document.getElementById('uploadSend');
const fileInput=document.getElementById('fileInput');const note=document.getElementById('note');const preview=document.getElementById('preview');
function openUpload(){uploadModal.classList.add('active');fileInput.value='';preview.innerHTML='';note.value='';}
function closeUpload(){uploadModal.classList.remove('active');}
uploadBtn.onclick=openUpload;uploadClose.onclick=closeUpload;uploadCancel.onclick=closeUpload;
fileInput.addEventListener('change',()=>{preview.innerHTML='';[...fileInput.files].forEach(f=>{const r=new FileReader();r.onload=e=>{const img=new Image();img.src=e.target.result;img.style.border='var(--border)';preview.appendChild(img);};r.readAsDataURL(f);});});
function pushLocal(){[...fileInput.files].forEach(f=>{const r=new FileReader();r.onload=e=>{state.photos.unshift({src:e.target.result,note:note.value||'',ts:Date.now()});persist();renderHistory();};r.readAsDataURL(f);});toast('Fotos salvas localmente');closeUpload();}
uploadLocal.onclick=()=>{if(!fileInput.files.length) return toast('Selecione ao menos uma imagem');pushLocal();}
async function sendFormspree(){if(!fileInput.files.length) return toast('Selecione ao menos uma imagem');const fd=new FormData();[...fileInput.files].forEach((f,i)=>fd.append('file'+i,f));fd.append('message',note.value||'');try{const res=await fetch('https://formspree.io/f/mzzavnrq',{method:'POST',body:fd,headers:{'Accept':'application/json'}});if(res.ok){toast('Enviado via Formspree');pushLocal();}else{toast('Falha no envio, salvo localmente');pushLocal();}}catch(e){toast('Offline ‚Äî salvo localmente');pushLocal();}}
uploadSend.onclick=sendFormspree;

/************** HISTORY CAROUSEL **************/
const history=document.getElementById('history');function renderHistory(){history.innerHTML='';state.photos.slice(0,12).forEach(p=>{const t=document.createElement('div');t.className='thumb';t.innerHTML=`<img src="${p.src}"/>`;history.appendChild(t);});}
renderHistory();

/************** RESET **************/
const resetBtn=document.getElementById('resetBtn');const resetModal=document.getElementById('resetModal');
const resetClose=document.getElementById('resetClose');const resetCancel=document.getElementById('resetCancel');const resetConfirm=document.getElementById('resetConfirm');
resetBtn.onclick=()=>resetModal.classList.add('active');resetClose.onclick=()=>resetModal.classList.remove('active');resetCancel.onclick=()=>resetModal.classList.remove('active');
resetConfirm.onclick=()=>{state.done={};state.photos=[];state.sessions=[];state.events=[];persist();document.querySelectorAll('.finish').forEach(i=>i.checked=false);document.querySelectorAll('.card').forEach(c=>c.classList.remove('done'));updateProgress();updateWeek();renderHistory();toast('Progresso resetado');resetModal.classList.remove('active');}

/************** PROGRESS INIT **************/
updateProgress();

/************** TOAST **************/
const toastEl=document.getElementById('toast');function toast(msg){toastEl.textContent=msg;toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),1600)}

/************** COACH **************/
const coach=document.getElementById('coach');let coachTimer=null;function showCoach(){clearTimeout(coachTimer);coach.classList.add('show');coachTimer=setTimeout(()=>coach.classList.remove('show'),2500)}
</script>
</body>
</html>
