import React, { useEffect, useRef, useState } from 'react';

 Single-file React component (Tailwind CSS assumed)
 Default LIGHT MODE. Click top icon to toggle DARK.
 Features implemented
 - Landing (drag downside to continue)
 - Top minimal upload icon - modal with photo + note, spinner + auto-close
 - Bottom nav (home opens landing; favoritesphoto) as glass icons (FontAwesome used)
 - Sections accordion (collapsed by default) with smooth accordion + blurfadeslide
 - Compact mode toggle (list-only text) vs full cards with video
 - PIP mini-player (custom floating) per card
 - Swipe gestures leftright for section navigation, down to close open section
 - Light theme default; dark toggled via icon (smooth transition)
 - Formspree already set in form action
 - Uses provided VIDEO_URLS array (map each exercise videoIdx)

export default function MfitTrainerApp(){
   THEME
  const [dark, setDark] = useState(false);  light first

   landing - app
  const [inApp, setInApp] = useState(false);

   avatar
  const [avatar, setAvatar] = useState(localStorage.getItem('mfit.avatar')  '');

   upload modal
  const [uploadOpen, setUploadOpen] = useState(false);
  const [uploading, setUploading] = useState(false);
  const uploadNoteRef = useRef(null);
  const uploadFileRef = useRef(null);

   PIP state
  const [pip, setPip] = useState(null);  { idx, left, top }

   compact mode
  const [compact, setCompact] = useState(false);

   sections (collapsed by default)
  const [openSection, setOpenSection] = useState(null);
  const [sectionIndex, setSectionIndex] = useState(0);

   saved completed sets
  const [doneMap, setDoneMap] = useState(() = JSON.parse(localStorage.getItem('mfit.done')'{}'));

  useEffect(()={ localStorage.setItem('mfit.done', JSON.stringify(doneMap)); }, [doneMap]);
  useEffect(()={ if(avatar) localStorage.setItem('mfit.avatar', avatar); }, [avatar]);

   keyboard safe - set css var
  useEffect(()={ const onResize=()=document.documentElement.style.setProperty('--vh', `${window.innerHeight}px`); window.addEventListener('resize', onResize); onResize(); return ()=window.removeEventListener('resize', onResize); }, []);

   Video urls (from your list) - ensure order matches exercises
  const VIDEO_URLS = [
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-dumbbell-sumo-squat-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Machine-leg-press-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Machine-machine-hip-adduction-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Machine-seated-leg-curl-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedmachines_1080Seated_Leg_Curl_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-calves-stretch-variation-3-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-dumbbell-suitcase-crunch-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cardio-treadmill-walk-side.mp4,

    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Dumbbells-dumbbell-front-rack-squat-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Machine-machine-hip-abduction-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cardio-elliptical-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-barbell-reverse-lunge-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandeddumbbells_1080DB_Sumo_Squat_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedmachines_1080Hip_Abduction_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-machine-leg-extension-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedmachines_1080Single_Leg_Extension_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedmachines_1080Leg_Press_FR_1080.mp4,

    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-shoulders-stretch-variation-1-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cardio-stationary-bike-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedbodyweight_1080Crunch_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cables-cable-single-arm-rope-pushdown-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-chest-stretch-variation-1-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Dumbbells-dumbbell-curl-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cables-cable-push-down-side.mp4,

    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cables-cable-single-arm-rope-pushdown-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-dumbbell-incline-chest-fly-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-dumbbell-incline-chest-flys-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Dumbbells-dumbbell-hammer-curl-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Dumbbells-dumbbell-neutral-overhead-press-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedbodyweight_1080V-Up_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Cardio-treadmill-walk-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-dumbbell-seated-overhead-press-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-Dumbbells-dumbbell-front-raise-side.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandeddumbbells_1080Neutral_Grip_DB_Press_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedcables_1080Seated_Row_V_Grip_FR_1080.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-machine-seated-cable-row-front.mp4,
    httpsmedia.musclewiki.commediauploadsvideosbrandedfemale-machine-pulldown-side.mp4
  ];

   Workouts structure (matching order and videoIdx)
  const WORKOUTS = [
    { categoria 'Treino de Quadr√≠ceps', itens [
      { nome'Agachamento Sum√¥ com Halteres', series'3x101010 (Drop ‚Äì conta como 1 s√©rie)', carga'0kg', intervalo60, sets3, videoIdx0 },
      { nome'Leg Press 45', series'4x15 (p√©s colados + 15 afastados)', carga'12kg', intervalo40, sets4, videoIdx1 },
      { nome'Adu√ß√£o de Quadril M√°quina', series'3x101010', carga'0kg', intervalo60, sets3, videoIdx2 },
      { nome'Cadeira Flexora', series'3x101010', carga'0kg', intervalo60, sets3, videoIdx3 },
      { nome'Cadeira Flexora Unilateral', series'3x10101010', carga'0kg', intervalo60, sets4, videoIdx4 },
      { nome'Panturrilha no Step', series'4x15', carga'0kg', intervalo30, sets4, videoIdx5 },
      { nome'Abdominal Canivete', series'4x15', carga'0kg', intervalo30, sets4, videoIdx6 },
      { nome'Esteira Caminhada', series'30 reps', carga'‚Äî', intervalo0, sets1, videoIdx7 },
    ]},
    { categoria 'Treino de Posterior e Gl√∫teo', itens [
      { nome'Agachamento com Halteres', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx8 },
      { nome'Abdu√ß√£o de Quadril M√°quina', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx9 },
      { nome'El√≠ptico', series'25 reps', carga'‚Äî', intervalo0, sets1, videoIdx10 },
      { nome'Afundo com Barra Livre', series'3x12 ‚Ä¢ 3x10 ‚Ä¢ 2x8', carga'0kg', intervalo60, sets8, videoIdx11 },
      { nome'Agachamento Sum√¥ no Step com Halteres', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx12 },
      { nome'Abdu√ß√£o de Quadril M√°quina', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx13 },
      { nome'Cadeira Extensora', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx14 },
      { nome'Cadeira Extensora Unilateral', series'3x10+10+10', carga'0kg', intervalo60, sets3, videoIdx15 },
      { nome'Leg Press 45 Unilateral', series'3x12 ‚Ä¢ 3x10 ‚Ä¢ 2x8', carga'0kg', intervalo60, sets8, videoIdx16 },
    ]},
    { categoria 'Treino de Peito, Tr√≠ceps e B√≠ceps', itens [
      { nome'Alongamento de Ombros e Tr√≠ceps II', series'3x20', carga'0kg', intervalo0, sets3, videoIdx17 },
      { nome'Bike Spinning Sentada', series'40 reps', carga'‚Äî', intervalo0, sets1, videoIdx18 },
      { nome'Abdominal Supra Solo', series'5x15', carga'0kg', intervalo40, sets5, videoIdx19 },
      { nome'Tr√≠ceps Unilateral na Polia Alta (Pegada Neutra)', series'3x15', carga'0kg', intervalo30, sets3, videoIdx20 },
      { nome'Alongamento de Peitoral Espaldar', series'3x15', carga'0kg', intervalo40, sets3, videoIdx21 },
      { nome'Mobilidade de Ombro III', series'3x20', carga'0kg', intervalo0, sets3, videoIdx22 },
      { nome'Rosca Alternada com Halteres', series'3x15', carga'0kg', intervalo30, sets3, videoIdx23 },
      { nome'Tr√≠ceps na Polia com Corda', series'3x15 lento + 15 curto', carga'0kg', intervalo30, sets3, videoIdx24 },
      { nome'Crucifixo com Halteres', series'4x12', carga'0kg', intervalo30, sets4, videoIdx26 },
      { nome'Crucifixo Inclinado com Halteres', series'4x12', carga'0kg', intervalo30, sets4, videoIdx27 },
      { nome'Rosca Martelo com Halteres', series'4x12', carga'0kg', intervalo30, sets4, videoIdx28 },
    ]},
    { categoria 'Treino de Ombro e Costas', itens [
      { nome'Puxada Alta (Pegada Neutra)', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx29 },
      { nome'Abdominal Canivete', series'3x12', carga'0kg', intervalo30, sets3, videoIdx30 },
      { nome'Esteira Caminhada', series'40 reps', carga'‚Äî', intervalo0, sets1, videoIdx31 },
      { nome'Eleva√ß√£o Lateral Unilateral Sentado com Halteres', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx32 },
      { nome'Eleva√ß√£o Frontal Alternada', series'3x12', carga'4‚Äì6kg', intervalo30, sets3, videoIdx33 },
      { nome'Desenvolvimento com Halteres (Pegada Neutra)', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx34 },
      { nome'Puxada Neutra Tri√¢ngulo', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx35 },
      { nome'Remada Baixa Tri√¢ngulo', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx36 },
      { nome'Puxada Aberta Barra Reta', series'3x1086', carga'0kg', intervalo30, sets3, videoIdx37 },
    ]}
  ];

   --------- gesture handlers for landing drag (to continue) ---------
  const landRef = useRef(null);
  useEffect(()={
    const el = landRef.current; if(!el) return;
    let startX=0,startY=0; const threshold=80; let dragging=false;
    const down=(e)={ dragging=true; startX=e.touchese.touches[0].clientXe.clientX; startY=e.touchese.touches[0].clientYe.clientY; };
    const move=(e)={ if(!dragging) return; const mx=(e.touchese.touches[0].clientXe.clientX)-startX; const my=(e.touchese.touches[0].clientYe.clientY)-startY; el.style.transform=`translate(${mx6}px, ${my3}px)`; };
    const up=(e)={ if(!dragging) return; dragging=false; const endY=e.changedTouchese.changedTouches[0].clientYe.clientY; const dy=endY-startY; const endX=e.changedTouchese.changedTouches[0].clientXe.clientX; const dx=endX-startX; el.style.transform='none'; if(dythreshold  Math.abs(dx)120){ setInApp(true); } };
    el.addEventListener('touchstart', down); el.addEventListener('touchmove', move); el.addEventListener('touchend', up);
    el.addEventListener('mousedown', down); window.addEventListener('mousemove', move); window.addEventListener('mouseup', up);
    return ()={ el.removeEventListener('touchstart', down); el.removeEventListener('touchmove', move); el.removeEventListener('touchend', up); el.removeEventListener('mousedown', down); window.removeEventListener('mousemove', move); window.removeEventListener('mouseup', up); };
  },[]);

   --------- swipe gestures between sections ---------
  const secRootRef = useRef(null);
  useEffect(()={
    const root = secRootRef.current; if(!root) return; let sx=0, sy=0; const onStart=(e)={ sx=e.touchese.touches[0].clientXe.clientX; sy=e.touchese.touches[0].clientYe.clientY; };
    const onEnd=(e)={ const ex=e.changedTouchese.changedTouches[0].clientXe.clientX; const ey=e.changedTouchese.changedTouches[0].clientYe.clientY; const dx=ex-sx; const dy=ey-sy; if(Math.abs(dx)80 && Math.abs(dx)Math.abs(dy)){ if(dx0) setSectionIndex(i=Math.min(i+1, WORKOUTS.length-1)); else setSectionIndex(i=Math.max(i-1,0)); }
      if(dy100) setOpenSection(null);
    };
    root.addEventListener('touchstart', onStart); root.addEventListener('touchend', onEnd);
    return ()={ root.removeEventListener('touchstart', onStart); root.removeEventListener('touchend', onEnd); };
  },[]);

  useEffect(()={  when sectionIndex changes, open that sec
    const s = Math.max(0, Math.min(WORKOUTS.length-1, sectionIndex)); setOpenSection(s);
  }, [sectionIndex]);

   --------- helpers toggle set done ---------
  function toggleDone(sIdx, iIdx, setIdx){ const key = `${sIdx}_${iIdx}_${setIdx}`; setDoneMap(m={ const n = {...m}; if(n[key]) delete n[key]; else n[key]=true; return n; }); }

   --------- upload modal logic ---------
  async function handleUploadSubmit(e){ e.preventDefault(); const file = uploadFileRef.current.files.[0]; const note = uploadNoteRef.current.value  '' ; if(!file) return alert('Escolha uma foto.'); setUploading(true);  simulate upload - send to formspree
    try{
      const fd = new FormData(); fd.append('photo', file); fd.append('note', note);
      await fetch('httpsformspree.iofmzzavnrq', { method'POST', bodyfd });
       show success, auto-close
      setTimeout(()={ setUploading(false); setUploadOpen(false); alert('Enviado!'); }, 900);
    }catch(err){ console.error(err); setUploading(false); alert('Falha ao enviar'); }
  }

   --------- PIP openclose ---------
  function openPip(idx){ if(pip && pip.idx===idx){ setPip(null); return; } setPip({ idx, leftwindow.innerWidth-240, top120 }); }

   --------- theme class on body ---------
  useEffect(()={ document.documentElement.classList.toggle('dark', dark); }, [dark]);

   Render
  return (
    div className={`min-h-screen transition-colors duration-300 ${dark 'bg-gray-900 text-gray-100'  'bg-white text-gray-900'}`} style={{height'var(--vh,100vh)'}}

      { TOP NAV }
      div className=fixed top-4 left-4 right-4 flex items-center gap-3 z-40
        div className=flex-1 
        div className=flex items-center gap-3
          { upload icon only (minimal) }
          button onClick={()=setUploadOpen(true)} className=p-2 bg-white60 darkbg-gray-80060 backdrop-blur rounded-lg border border-white20 shadow-sm
            i className=fas fa-upload 
          button
          { theme toggle }
          button onClick={()=setDark(d=!d)} className=p-2 bg-white60 darkbg-gray-80060 backdrop-blur rounded-lg border border-white20 shadow-sm
            {dark  i className=fas fa-sun text-yellow-400   i className=fas fa-moon text-gray-700 }
          button
          { avatar small }
          div className=w-10 h-10 rounded-md overflow-hidden border border-white20
            {avatar  img src={avatar} alt=avatar className=w-full h-full object-cover  div className=w-full h-full bg-gradient-to-br from-sky-200 to-blue-400}
          div
        div
      div

      { LANDING (clean, drag to continue) }
      {!inApp && (
        main ref={landRef} className=flex items-center justify-center h-full
          div className=w-[92%] max-w-md p-8 rounded-3xl glass drop-shadow-lg transition-transform duration-400 style={{backdropFilter'blur(18px)'}}
            div className=flex flex-col items-center gap-4
              div className=w-24 h-24 rounded-xl overflow-hidden border border-white20
                {avatar  img src={avatar} alt=avatar className=w-full h-full object-cover  div className=w-full h-full bg-gradient-to-br from-pink-300 via-indigo-300 to-cyan-200}
              div
              h1 className=text-2xl font-extraboldWelcome!h1
              p className=text-sm text-gray-500Arraste para baixo ou para o lado para continuarp

              div className=w-20 h-1 rounded-full bg-gray-200 

              div className=flex gap-3
                button className=px-4 py-2 rounded-full bg-yellow-300 shadow onClick={()=setInApp(true)}Arrastar (demo)button
                button className=px-4 py-2 rounded-full border onClick={()=setUploadOpen(true)}Enviar fotobutton
              div
            div
          div
        main
      )}

      { APP }
      {inApp && (
        div className=pt-20 pb-28 px-4 ref={secRootRef}
          { Sections container }
          div className=space-y-4
            { compact toggle + view style }
            div className=flex items-center justify-between
              div className=flex items-center gap-2
                span className=text-sm font-semiboldSe√ß√µesspan
                span className=text-xs text-gray-400(swipe leftright)span
              div
              div className=flex items-center gap-2
                button onClick={()=setCompact(c=!c)} className=px-2 py-1 rounded-full border bg-white60{compact 'Cards'  'Compact'}button
              div
            div

            {WORKOUTS.map((sec, sIdx)={
              const opened = openSection===sIdx;
              const accordionStyle = opened  {height 'auto', opacity1, transform'translateY(0)'}  {height0, opacity0, transform'translateY(-8px)'};
              return (
                section key={sec.categoria} className={`rounded-2xl p-3 transition-all duration-300 ${opened 'bg-white darkbg-gray-800'''}`}
                  header className=flex items-center justify-between onClick={()=setOpenSection(opened null  sIdx)}
                    div className=flex items-center gap-3
                      div className=w-10 h-10 rounded-md flex items-center justify-center bg-gradient-to-br from-sky-300 to-blue-400 text-whiteüèãÔ∏èdiv
                      div
                        div className=font-semibold{sec.categoria}div
                        div className=text-xs text-gray-400{sec.itens.length} exerc√≠ciosdiv
                      div
                    div
                    div className=flex items-center gap-2
                      button className={`p-2 rounded-full transition-transform ${opened 'rotate-45'''}`} onClick={(e)={ e.stopPropagation(); setOpenSection(opened null  sIdx);}}{opened '‚àí'  '+'}button
                    div
                  header

                  div className=overflow-hidden transition-all duration-300 mt-3 style={accordionStyle}
                    div className={`grid gap-3 ${compact 'grid-cols-1''grid-cols-1'}`}
                      {sec.itens.map((it, iIdx)= (
                        article key={it.nome} className=rounded-xl p-3 border transition-shadow hovershadow-lg bg-white darkbg-gray-900
                          div className=flex items-start gap-3
                            div className=flex-1
                              h4 className=font-semibold{it.nome}h4
                              div className=text-sm text-gray-500{it.series} ‚Ä¢ {it.carga} {it.intervalo `‚Ä¢ Intervalo ${it.intervalo}s` '' }div
                              div className=mt-2 flex items-center gap-2
                                { set bubbles }
                                {Array.from({length Math.max(1, it.sets1)}).map((_, si)={
                                  const key = `${sIdx}_${iIdx}_${si}`;
                                  const done = !!doneMap[key];
                                  return (
                                    button key={si} onClick={()=toggleDone(sIdx, iIdx, si)} className={`w-8 h-8 rounded-full text-xs ${done 'bg-green-400 text-white''bg-gray-100 text-gray-700'}`}{si+1}button
                                  );
                                })}

                                { timer compact shows only set interval }
                                {it.intervalo0 && (
                                  div className=ml-3 text-sm text-gray-600Timer {Math.floor(it.intervalo)}sdiv
                                )}

                                { pip toggle }
                                button onClick={()=openPip(it.videoIdx)} className=ml-auto px-3 py-1 rounded-md borderüî≤button
                              div
                            div
                            { video area (only in full mode) }
                            {!compact && (
                              div className=w-36 h-24 rounded-md overflow-hidden bg-black
                                video src={VIDEO_URLS[it.videoIdx]} muted playsInline preload=metadata className=w-full h-full object-cover 
                              div
                            )}
                          div
                        article
                      ))}
                    div
                  div
                section
              );
            })}
          div
        div
      )}

      { Bottom nav }
      nav className=fixed left-4 right-4 bottom-4 z-50 flex justify-around items-center p-3 rounded-2xl bg-white70 darkbg-gray-80060 backdrop-blur border
        button onClick={()={ setInApp(false); setOpenSection(null); }} className=flex flex-col items-center text-sm i className=fas fa-home span className=text-xsHomespan button
        button onClick={()=alert('Favoritos demo')} className=flex flex-col items-center text-sm i className=fas fa-heart span className=text-xsFavspan button
        button onClick={()=setUploadOpen(true)} className=flex flex-col items-center text-sm i className=fas fa-camera span className=text-xsFotospan button
      nav

      { Upload Modal }
      {uploadOpen && (
        div className=fixed inset-0 z-60 grid place-items-center bg-black40 onClick={()={ if(!uploading) setUploadOpen(false); }}
          form onSubmit={handleUploadSubmit} className=bg-white darkbg-gray-900 p-4 rounded-xl w-[92%] max-w-lg glass onClick={(e)=e.stopPropagation()}
            h3 className=font-semiboldEnviar fotoh3
            input ref={uploadFileRef} type=file accept=image className=mt-3 
            textarea ref={uploadNoteRef} placeholder=Observa√ß√£o (opcional) className=mt-3 p-2 w-full rounded-md border 
            div className=mt-3 flex items-center justify-end gap-3
              button type=button onClick={()=setUploadOpen(false)} className=px-3 py-1 rounded-mdFecharbutton
              button type=submit className=px-4 py-2 rounded-md bg-blue-500 text-white{uploading (span className=flex items-center gap-2svg className=animate-spin w-4 h-4 viewBox=0 0 24 24circle className=opacity-25 cx=12 cy=12 r=10 stroke=currentColor strokeWidth=4 fill=nonepath className=opacity-75 fill=currentColor d=M4 12a8 8 0 018-8v4l3-3-3-3v4a12 12 0 10 0 24v-4l-3 3 3 3v-4a8 8 0 01-8-8zsvg Enviandospan)  'Enviar'}button
            div
          form
        div
      )}

      { PIP element }
      {pip && (
        div className=fixed z-70 right-6 bottom-28 w-56 h-36 bg-white90 rounded-md shadow-lg overflow-hidden draggable style={{touchAction'none'}}
          video src={VIDEO_URLS[pip.idx]} controls autoPlay className=w-full h-full object-cover 
        div
      )}

    div
  );
}
