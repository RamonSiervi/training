<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>MFIT – Treinos (Mobile)</title>
  <style>
    :root{
      /* cores base (glassmorphism, claras) */
      --bg: #0b1020;
      --card: rgba(255,255,255,.06);
      --card-strong: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.14);
      --txt: #e9eefb;
      --muted: #b8c4e4;
      --brand: #6aa9ff;
      --success: #35d49a;
      --danger: #ff6a95;
      --shadow: 0 12px 30px rgba(0,0,0,.38);
      --blur: 16px;
      --radius-xl: 18px;
      --tr: .32s cubic-bezier(.2,.9,.2,1); /* transições mais fluidas */
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--txt);
      background: linear-gradient(160deg,#071428 0%, #0f2748 100%);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      overflow:hidden; /* app mobile */
    }

    /* helpers */
    .glass-card{ backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); background:var(--card); border:1px solid var(--stroke); box-shadow:var(--shadow); border-radius:var(--radius-xl); }
    .hidden{ display:none !important; }

    /* VIEW LAYOUT */
    .view{ position:absolute; inset:0; display:flex; flex-direction:column; }
    .center{ display:flex; align-items:center; justify-content:center; }

    /* Landing */
    .landing{ padding:28px; gap:18px; text-align:center; }
    .title{ font-size:26px; margin:6px 0 0; font-weight:800; color:linear-gradient(90deg,#fff,#b8d7ff); }
    .avatar-wrap{ position:relative; width:110px; height:110px; border-radius:18px; overflow:hidden; border:1px solid var(--stroke); }
    .avatar-wrap img{ width:100%; height:100%; object-fit:cover; display:block; }
    .icon-btn{ width:44px; height:44px; border-radius:12px; border:1px solid var(--stroke); background:var(--card); display:grid; place-items:center; cursor:pointer; transition:transform var(--tr), border-color var(--tr); }
    .btn-primary{ display:inline-flex; align-items:center; justify-content:center; gap:10px; border-radius:14px; padding:12px 16px; color:#071022; background:linear-gradient(135deg,#9ad5ff,#6aa9ff); border:none; font-weight:700; box-shadow:0 8px 20px #6aa9ff33; }

    /* APP shell */
    .app{ opacity:0; pointer-events:none; transform:translateY(8px); transition:opacity var(--tr), transform var(--tr); }
    .app.active{ opacity:1; pointer-events:auto; transform:none; }

    /* NAVBAR */
    .navbar{ height:64px; display:flex; align-items:center; gap:12px; padding:0 12px; }
    .nav-glass{ backdrop-filter: blur(calc(var(--blur) - 6px)); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border-bottom:1px solid var(--stroke); }
    .burger{ width:44px; height:44px; border-radius:12px; display:grid; place-items:center; border:1px solid var(--stroke); background:var(--card); }
    .brand{ font-weight:800; letter-spacing:.6px; }

    /* WEATHER – agora Salvador, BRA */
    .pill.weather{ display:flex; gap:10px; align-items:center; padding:8px 12px; border-radius:999px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid var(--stroke); }
    .wx-icon{ width:34px; height:34px; border-radius:10px; display:grid; place-items:center; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); }
    .wx-temp{ font-weight:700; font-size:13px; opacity:.95; }
    .wx-place{ font-size:12px; color:var(--muted); }

    /* SIDEBAR */
    .sidebar{ position:fixed; top:12px; left:12px; bottom:12px; width:72vw; max-width:320px; transform:translateX(-110%); transition:transform var(--tr); padding:18px; display:flex; flex-direction:column; gap:14px; z-index:40; }
    .sidebar.active{ transform:none; }
    .side-header{ display:flex; align-items:center; gap:10px; }
    .side-link{ padding:12px 14px; border-radius:12px; border:1px solid var(--stroke); background:var(--card); cursor:pointer; }
    .side-divider{ height:1px; background:linear-gradient(90deg, rgba(255,255,255,0), var(--stroke), rgba(255,255,255,0)); margin:8px 0; }

    /* SEARCH spotlight full-screen */
    .search-panel{ position:fixed; inset:0; display:none; z-index:60; align-items:center; justify-content:center; }
    .search-panel.on{ display:flex; }
    .search-spot{ width:94%; max-width:760px; padding:18px; border-radius:16px; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); backdrop-filter: blur(28px); box-shadow:var(--shadow); }
    .search-spot input{ width:100%; font-size:18px; border:none; background:transparent; color:var(--txt); outline:none; }

    /* CONTENT area */
    .content{ position:absolute; inset:64px 0 74px; overflow:auto; padding:12px; display:grid; gap:12px; }
    .welcome{ padding:12px 14px; display:flex; align-items:center; justify-content:space-between; }

    /* WORKOUT SECTIONS (collapsed card behavior) */
    .section{ overflow:visible; }
    .section-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px; cursor:pointer; }
    .section-title{ font-weight:800; }

    /* collapse container */
    .section-body{
      transform-origin:top center;
      transition: opacity var(--tr), transform var(--tr), filter var(--tr);
      opacity:0; transform: translateY(-6px) scale(.995); filter: blur(6px);
      height:0; overflow:hidden;
    }
    .section.open .section-body{
      opacity:1; transform: translateY(0) scale(1); filter: blur(0); height:auto; margin-top:8px;
    }

    .workout-card{ display:grid; gap:10px; padding:12px; border-radius:14px; border:1px solid var(--stroke); background:var(--card); transition: transform var(--tr), box-shadow var(--tr); }
    .workout-card:hover{ transform: translateY(-3px); }

    .w-title{ font-size:15px; font-weight:800; margin:0; }
    .w-meta{ color:var(--muted); font-size:13px; }

    /* set bubbles */
    .sets{ display:flex; gap:8px; flex-wrap:wrap; }
    .set-bubble{ min-width:34px; height:34px; padding:0 10px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--stroke); background:rgba(255,255,255,.04); font-size:13px; cursor:pointer; transition: all var(--tr); }
    .set-bubble.done{ background:linear-gradient(135deg,#7df0c6,#35d49a); color:#04221c; border-color:transparent; box-shadow:0 8px 24px #35d49a33; }

    /* Timer compact: mostra só o tempo padrão para o treino se houver */
    .timer{ display:flex; align-items:center; gap:8px; }
    .timer-display{ font-weight:800; min-width:56px; text-align:center; font-size:14px; }
    .btn{ border:1px solid var(--stroke); background:transparent; color:var(--txt); border-radius:999px; padding:8px 10px; font-size:13px; cursor:pointer; }
    .btn-brand{ background:linear-gradient(135deg,#9ad5ff,#6aa9ff); color:#081425; border:none; padding:8px 12px; border-radius:12px; }

    /* pulse animation */
    @keyframes pulse { 0%{ transform:scale(1); box-shadow:0 0 0 0 rgba(53,212,154,.6);} 70%{ transform:scale(1.04); box-shadow:0 0 0 14px rgba(53,212,154,0);} 100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(53,212,154,0);} }
    .pulse{ animation: pulse .9s ease-in-out infinite; }

    /* bottom nav glass icons */
    .bottom-bar{ position:fixed; left:12px; right:12px; bottom:12px; height:68px; display:flex; align-items:center; justify-content:space-around; padding:10px; border-radius:14px; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); backdrop-filter: blur(calc(var(--blur) - 6px)); z-index:50; }
    .nav-item{ width:56px; height:48px; border-radius:12px; display:grid; place-items:center; transition: transform var(--tr), box-shadow var(--tr); border:1px solid transparent; background:transparent; }
    .nav-item.glass{ border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); }
    .nav-item.active{ box-shadow:0 8px 20px rgba(0,0,0,.35); transform:translateY(-4px); }

    /* floating mini-player (PIP) */
    .pip{ position:fixed; width:220px; height:124px; right:18px; bottom:100px; z-index:70; border-radius:12px; overflow:hidden; border:1px solid var(--stroke); background:var(--card); box-shadow:0 20px 40px rgba(0,0,0,.55); display:grid; grid-template-rows:1fr 36px; }
    .pip video{ width:100%; height:100%; object-fit:cover; }
    .pip-controls{ display:flex; align-items:center; justify-content:space-between; padding:6px 8px; }

    /* gestures hint */
    .hint{ font-size:12px; color:var(--muted); }

    /* responsive tweaks */
    @media(min-width:900px){ .content{ padding:28px; } }
  </style>
</head>
<body>
  <!-- VIEW 1: Landing / Perfil (foto fixa) -->
  <section class="view landing center" id="view-landing">
    <div class="landing-hero glass-card center" style="flex-direction:column; padding:22px;">
      <div class="brand-badge tiny">MFIT PERSONAL</div>
      <h1 class="title">Seu treino, limpo e preciso</h1>
      <p class="subtitle">Toque para adicionar sua foto (fica salva). Depois, <b>ENTRAR</b>.</p>

      <div class="avatar-wrap mt-10" id="landingAvatar">
        <img id="landingAvatarImg" alt="Seu avatar" src=""/>
      </div>
      <div class="avatar-actions mt-10" style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px;">
        <label class="icon-btn" title="Selecionar foto">
          <input id="avatarInput" type="file" accept="image/*" hidden>
          <!-- ícone camera -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 17a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="1.5"/><path d="M3 9c0-1.1.9-2 2-2h1.2a2 2 0 0 0 1.8-1.1l.6-1.2A2 2 0 0 1 10.2 3h3.6a2 2 0 0 1 1.8 1.1l.6 1.2a2 2 0 0 0 1.8 1.1H19c1.1 0 2 .9 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V9Z" stroke="currentColor" stroke-width="1.5"/></svg>
        </label>
        <button id="btnEnter" class="btn-primary">ENTRAR</button>
      </div>
      <div class="tiny" style="margin-top:8px; opacity:.7">Sua foto aparecerá no topo do app e fica salva neste dispositivo.</div>
    </div>
  </section>

  <!-- VIEW 2: App -->
  <section class="view app" id="view-app">
    <!-- Navbar topo -->
    <header class="navbar nav-glass">
      <div class="nav-left">
        <button class="burger" id="btnSidebar" title="Menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
        </button>
        <div class="brand">MFIT</div>
      </div>

      <!-- Weather Salvador, BR -->
      <div class="pill weather" title="Clima em Salvador">
        <div class="wx-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4V2M12 22v-2M4 12H2M22 12h-2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.4"/></svg>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-start;">
          <div class="wx-temp" id="wxTemp">28°</div>
          <div class="wx-place">Salvador, BRA</div>
        </div>
      </div>

      <div class="nav-right" style="margin-left:auto;display:flex;align-items:center;gap:8px;">
        <button class="search" id="btnSearch" title="Buscar" aria-label="Buscar" style="width:44px;height:44px;border-radius:12px;border:1px solid var(--stroke);background:var(--card);display:grid;place-items:center;">
          <!-- lupa -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/><path d="m20 20-3.5-3.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
        </button>
        <div class="avatar-sm" title="Seu perfil" style="width:44px;height:44px;border-radius:10px;border:1px solid var(--stroke);overflow:hidden;">
          <img id="topAvatar" alt="avatar" src="" style="width:100%;height:100%;object-fit:cover;display:block;"/>
        </div>
      </div>
    </header>

    <!-- Sidebar clean -->
    <aside class="sidebar glass-card" id="sidebar">
      <div class="side-header">
        <div class="avatar-sm" style="width:54px;height:54px;border-radius:12px;overflow:hidden;border:1px solid var(--stroke);"><img id="sideAvatar" alt="avatar" src="" style="width:100%;height:100%;object-fit:cover;"/></div>
        <div>
          <div style="font-weight:800">Você</div>
          <div class="tiny" id="deviceNote">Foto salva no dispositivo</div>
        </div>
      </div>

      <div class="side-divider"></div>
      <button class="side-link" id="btnResetAll">🔄 Limpar concluídos</button>
      <button class="side-link" id="btnChangePhoto">📸 Trocar foto</button>
      <div style="height:8px"></div>
      <div class="side-divider"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="side-link" id="sectionToggle_quads">Quadríceps</button>
        <button class="side-link" id="sectionToggle_post">Posterior</button>
        <button class="side-link" id="sectionToggle_push">Peito/Bracos</button>
        <button class="side-link" id="sectionToggle_back">Ombro/Costas</button>
      </div>
      <div class="side-footer tiny" style="margin-top:auto">v1.0 • Interface Mobile Glass</div>
      <input id="sidePhotoInput" type="file" accept="image/*" hidden>
    </aside>

    <!-- Search spotlight full-screen -->
    <div class="search-panel" id="searchPanel" role="dialog" aria-modal="true">
      <div class="search-spot glass-card">
        <input id="searchInput" placeholder="Buscar exercício... (ex.: agachamento)" aria-label="Pesquisar" />
      </div>
    </div>

    <!-- Conteúdo -->
    <main class="content" id="content">
      <section class="welcome glass-card">
        <div>
          <div class="tiny" style="opacity:.8">Bons treinos</div>
          <h3 style="margin:2px 0 0">Rotinas</h3>
          <div class="hint">Swipe left/right para trocar seções • Swipe down para fechar</div>
        </div>
        <!-- botão enviar foto (Formspree – ícone apenas) -->
        <form id="photoForm" action="https://formspree.io/f/mzzavnrq" method="POST" enctype="multipart/form-data">
          <label class="icon-btn" title="Enviar foto (Formspree)">
            <input id="formPhotoInput" type="file" name="photo" accept="image/*" hidden>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 16V4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><path d="M7 9l5-5 5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><rect x="3" y="13" width="18" height="7" rx="2" stroke="currentColor" stroke-width="1.6"/></svg>
          </label>
        </form>
      </section>

      <!-- LISTAS DE TREINOS EM SEÇÕES (FECHADAS POR PADRÃO) -->
      <div id="sectionsRoot"></div>

    </main>

    <!-- Floating PIP container (inserido dinamicamente) -->

    <!-- Bottom Navigation (glass icons) -->
    <nav class="bottom-bar" id="bottomBar">
      <button class="nav-item glass" data-tab="fav" title="Favoritos">❤</button>
      <button class="nav-item glass active" data-tab="home" title="Home">🏠</button>
      <button class="nav-item glass" data-tab="photo" title="Foto">📸</button>
    </nav>
  </section>

  <script>
  /* =============================
     SCRIPT.JS — DETALHES & ATUALIZAÇÕES
     - Weather fixado para Salvador (texto apenas)
     - Formspree já configurado
     - Seções começam fechadas
     - Blur + fade + slide nas aberturas
     - Spotlight search full-screen
     - Gestos: swipe left/right entre seções, swipe down para fechar
     - PIP (mini-player) por vídeo
     - Timer por exercício mostra apenas o tempo padrão definido
     ============================= */

  const $ = (s, d=document) => d.querySelector(s);
  const $$ = (s, d=document) => Array.from(d.querySelectorAll(s));

  const LS = { AVATAR: 'mfit.avatar.dataUrl', DONE: 'mfit.sets.done' };
  const state = { view:'landing', done:{}, currentSectionIndex:0, pip:null };

  // Dados (mapeados com os vídeos na ordem fornecida)
  const VIDEO_URLS = [
    "https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-sumo-squat-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-leg-press-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-adduction-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-seated-leg-curl-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Seated_Leg_Curl_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-calves-stretch-variation-3-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-suitcase-crunch-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4",

    "https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-rack-squat-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-abduction-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-elliptical-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-barbell-reverse-lunge-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/DB_Sumo_Squat_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Hip_Abduction_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-machine-leg-extension-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Single_Leg_Extension_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Leg_Press_FR_1080.mp4",

    "https://media.musclewiki.com/media/uploads/videos/branded/female-shoulders-stretch-variation-1-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-stationary-bike-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/Crunch_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-chest-stretch-variation-1-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-curl-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-push-down-side.mp4",

    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-fly-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-flys-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-hammer-curl-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-neutral-overhead-press-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/V-Up_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-seated-overhead-press-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-raise-side.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/Neutral_Grip_DB_Press_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/cables/_1080/Seated_Row_V_Grip_FR_1080.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-machine-seated-cable-row-front.mp4",
    "https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4"
  ];

  const WORKOUTS = [
    { categoria: 'Treino de Quadríceps', itens: [
      { nome:'Agachamento Sumô com Halteres', series:'3x10/10/10 (Drop – conta como 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:0 },
      { nome:'Leg Press 45', series:'4x15 pés colados + 15 afastados', carga:'12kg', intervalo:40, sets:4, videoIdx:1 },
      { nome:'Adução de Quadril Máquina', series:'3x10/10/10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:2 },
      { nome:'Cadeira Flexora', series:'3x10/10/10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:3 },
      { nome:'Cadeira Flexora Unilateral', series:'3x10/10/10/10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:4, videoIdx:4 },
      { nome:'Panturrilha no Step', series:'4x15', carga:'0kg', intervalo:30, sets:4, videoIdx:5 },
      { nome:'Abdominal Canivete', series:'4x15', carga:'0kg', intervalo:30, sets:4, videoIdx:6 },
      { nome:'Esteira Caminhada', series:'30 reps', carga:'—', intervalo:0, sets:1, videoIdx:7 },
    ]},

    { categoria: 'Treino de Posterior e Glúteo', itens: [
      { nome:'Agachamento com Halteres', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:8 },
      { nome:'Abdução de Quadril Máquina', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:9 },
      { nome:'Elíptico', series:'25 reps', carga:'0kg', intervalo:0, sets:1, videoIdx:10 },
      { nome:'Afundo com Barra Livre', series:'3x12 • 3x10 • 2x8', carga:'0kg', intervalo:60, sets:8, videoIdx:11 },
      { nome:'Agachamento Sumô no Step com Halteres', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:12 },
      { nome:'Abdução de Quadril Máquina', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:13 },
      { nome:'Cadeira Extensora', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:14 },
      { nome:'Cadeira Extensora Unilateral', series:'3x10+10+10 (Drop – 1 série)', carga:'0kg', intervalo:60, sets:3, videoIdx:15 },
      { nome:'Leg Press 45 Unilateral', series:'3x12 • 3x10 • 2x8', carga:'0kg', intervalo:60, sets:8, videoIdx:16 },
    ]},

    { categoria: 'Treino de Peito, Tríceps e Bíceps', itens: [
      { nome:'Alongamento de Ombros e Tríceps II', series:'3x20', carga:'0kg', intervalo:0, sets:3, videoIdx:17 },
      { nome:'Bike Spinning Sentada', series:'40 reps', carga:'—', intervalo:0, sets:1, videoIdx:18 },
      { nome:'Abdominal Supra Solo', series:'5x15', carga:'0kg', intervalo:40, sets:5, videoIdx:19 },
      { nome:'Tríceps Unilateral na Polia Alta (Pegada Neutra)', series:'3x15', carga:'0kg', intervalo:30, sets:3, videoIdx:20 },
      { nome:'Alongamento de Peitoral Espaldar', series:'3x15', carga:'0kg', intervalo:40, sets:3, videoIdx:21 },
      { nome:'Mobilidade de Ombro III', series:'3x20', carga:'0kg', intervalo:0, sets:3, videoIdx:22 },
      { nome:'Rosca Alternada com Halteres', series:'3x15', carga:'0kg', intervalo:30, sets:3, videoIdx:23 },
      { nome:'Tríceps na Polia com Corda', series:'3x15 lento + 15 curto', carga:'0kg', intervalo:30, sets:3, videoIdx:24 },
      { nome:'Tríceps Unilateral na Polia Alta (Pegada Neutra)', series:'3x15', carga:'0kg', intervalo:30, sets:3, videoIdx:25 },
      { nome:'Crucifixo com Halteres', series:'4x12', carga:'0kg', intervalo:30, sets:4, videoIdx:26 },
      { nome:'Crucifixo Inclinado com Halteres', series:'4x12', carga:'0kg', intervalo:30, sets:4, videoIdx:27 },
      { nome:'Rosca Martelo com Halteres', series:'4x12', carga:'0kg', intervalo:30, sets:4, videoIdx:28 },
    ]},

    { categoria: 'Treino de Ombro e Costas', itens: [
      { nome:'Puxada Alta (Pegada Neutra)', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:29 },
      { nome:'Abdominal Canivete', series:'3x12', carga:'0kg', intervalo:30, sets:3, videoIdx:30 },
      { nome:'Esteira Caminhada', series:'40 reps', carga:'—', intervalo:0, sets:1, videoIdx:31 },
      { nome:'Elevação Lateral Unilateral Sentado com Halteres', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:32 },
      { nome:'Elevação Frontal Alternada', series:'3x12', carga:'4–6kg', intervalo:30, sets:3, videoIdx:33 },
      { nome:'Desenvolvimento com Halteres (Pegada Neutra)', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:34 },
      { nome:'Puxada Neutra Triângulo', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:35 },
      { nome:'Remada Baixa Triângulo', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:36 },
      { nome:'Puxada Aberta Barra Reta', series:'3x10/8/6 (Drop – 1 série)', carga:'0kg', intervalo:30, sets:3, videoIdx:37 },
    ]}
  ];

  // Restore state
  function restoreState(){
    try{
      const avatar = localStorage.getItem(LS.AVATAR);
      if(avatar) setAvatar(avatar);
      const done = JSON.parse(localStorage.getItem(LS.DONE) || '{}');
      state.done = done || {};
    }catch(e){ console.warn(e); }
  }

  function persistDone(){ localStorage.setItem(LS.DONE, JSON.stringify(state.done)); }

  function setAvatar(dataUrl){ $('#landingAvatarImg').src = dataUrl||placeholder(); $('#topAvatar').src = dataUrl||placeholder(); $('#sideAvatar').src = dataUrl||placeholder(); }
  function placeholder(){ const svg = encodeURIComponent(`<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='#9ad5ff'/><stop offset='100%' stop-color='#6aa9ff'/></linearGradient></defs><rect width='120' height='120' rx='24' fill='url(#g)'/><circle cx='60' cy='44' r='20' fill='rgba(255,255,255,.85)'/><rect x='24' y='74' width='72' height='26' rx='13' fill='rgba(255,255,255,.85)'/></svg>`); return `data:image/svg+xml;charset=UTF-8,${svg}`; }

  async function readFileAsDataURL(file){ return await new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }

  // Build sections (start closed)
  function renderSections(){
    const root = $('#sectionsRoot'); root.innerHTML='';
    WORKOUTS.forEach((sec, sIdx)=>{
      const secEl = document.createElement('section'); secEl.className='section glass-card';
      secEl.dataset.index = sIdx;

      const header = document.createElement('div'); header.className='section-header';
      header.innerHTML = `<div><div class="section-title">${sec.categoria}</div><div class="hint">Toque para abrir • Swipe</div></div><div class="tiny">${sec.itens.length} exercícios</div>`;
      secEl.appendChild(header);

      const body = document.createElement('div'); body.className='section-body';

      // each workout card
      sec.itens.forEach((it, idx)=>{
        const card = document.createElement('article'); card.className='workout-card';
        card.dataset.search = `${it.nome.toLowerCase()} ${sec.categoria.toLowerCase()}`;

        const head = document.createElement('div'); head.style.display='flex'; head.style.justifyContent='space-between'; head.style.alignItems='center';
        head.innerHTML = `<div><h4 class="w-title">${it.nome}</h4><div class="w-meta">${it.series} • Carga: ${it.carga}${it.intervalo?` • Intervalo: ${it.intervalo}s`:''}</div></div>`;

        const controls = document.createElement('div'); controls.style.display='flex'; controls.style.alignItems='center'; controls.style.gap='8px';

        // set bubbles
        const setsWrap = document.createElement('div'); setsWrap.className='sets';
        const totalSets = Math.max(1, it.sets || 1);
        for(let si=0; si<totalSets; si++){
          const b = document.createElement('button'); b.className='set-bubble'; b.textContent = si+1; b.dataset.card=`s${sIdx}_i${idx}`; b.dataset.index=si;
          const key = `${sIdx}_${idx}_${si}`;
          if(state.done[key]) b.classList.add('done');
          b.addEventListener('click', ()=>{ const k=key; if(!state.done[k]){ state.done[k]=true; b.classList.add('done'); } else { delete state.done[k]; b.classList.remove('done'); } persistDone(); });
          setsWrap.appendChild(b);
        }

        controls.appendChild(setsWrap);

        // Timer (compact): show only standard interval button
        if(it.intervalo && it.intervalo>0){
          const tWrap = document.createElement('div'); tWrap.className='timer';
          const display = document.createElement('div'); display.className='timer-display'; display.textContent = formatMMSS(it.intervalo);
          const startBtn = document.createElement('button'); startBtn.className='btn btn-brand'; startBtn.textContent='Iniciar';
          const stopBtn = document.createElement('button'); stopBtn.className='btn'; stopBtn.textContent='Parar';
          tWrap.appendChild(display); tWrap.appendChild(startBtn); tWrap.appendChild(stopBtn);
          controls.appendChild(tWrap);
          attachTimer(startBtn, stopBtn, display, it.intervalo);
        }

        // Video mini player toggle
        const vidBtn = document.createElement('button'); vidBtn.className='btn'; vidBtn.textContent='🔲'; vidBtn.title='Abrir mini-player (PIP)';
        vidBtn.addEventListener('click', ()=> togglePIP(it.videoIdx));
        controls.appendChild(vidBtn);

        head.appendChild(controls);
        card.appendChild(head);

        // hidden video preview inside card (tap to open large)
        const preview = document.createElement('div'); preview.style.marginTop='8px';
        const video = document.createElement('video'); video.src = VIDEO_URLS[it.videoIdx] || ''; video.muted=true; video.playsInline=true; video.controls=false; video.style.width='100%'; video.style.borderRadius='10px'; video.style.maxHeight='160px'; video.preload='metadata';
        preview.appendChild(video);
        card.appendChild(preview);

        // quick play on tap of preview (large modal)
        preview.addEventListener('click', ()=> openModalVideo(it.videoIdx));

        body.appendChild(card);
      });

      secEl.appendChild(body);
      root.appendChild(secEl);

      // header toggle behavior
      header.addEventListener('click', ()=>{ const opened = secEl.classList.toggle('open'); if(opened){ // close others
          $$('.section').forEach(s=>{ if(s!==secEl) s.classList.remove('open'); });
        }
      });

    });

    // open first section by default? we'll keep closed per request
  }

  // Timer helper
  function formatMMSS(total){ const m=Math.floor(total/60).toString().padStart(2,'0'); const s=(total%60).toString().padStart(2,'0'); return `${m}:${s}`; }
  function attachTimer(startBtn, stopBtn, display, seconds){ let tId=null, rem=seconds; startBtn.addEventListener('click', ()=>{ rem=seconds; display.textContent=formatMMSS(rem); if(tId) clearInterval(tId); tId=setInterval(()=>{ rem--; display.textContent=formatMMSS(rem); if(rem<=5 && rem>0){ try{ navigator.vibrate && navigator.vibrate([200,50,200]); }catch(e){} display.classList.add('pulse'); } if(rem<=0){ clearInterval(tId); tId=null; display.classList.remove('pulse'); display.textContent='✅'; setTimeout(()=>display.textContent=formatMMSS(seconds),1200); } },1000); }); stopBtn.addEventListener('click', ()=>{ if(tId) clearInterval(tId); tId=null; display.classList.remove('pulse'); display.textContent=formatMMSS(seconds); }); }

  // PIP (custom floating mini-player)
  function togglePIP(videoIdx){ // if pip already with same video, close
    if(state.pip && state.pip.idx===videoIdx){ closePIP(); return; }
    openPIP(videoIdx);
  }
  function openPIP(idx){ closePIP(); const pip = document.createElement('div'); pip.className='pip glass-card'; pip.dataset.idx=idx; const v = document.createElement('video'); v.src = VIDEO_URLS[idx] || ''; v.autoplay=true; v.muted=false; v.loop=true; v.playsInline=true; v.controls=true; pip.appendChild(v);
    const ctrl = document.createElement('div'); ctrl.className='pip-controls'; const title = document.createElement('div'); title.className='tiny'; title.textContent = WORKOUTS.flatMap(w=>w.itens).filter((_,i)=>i===idx).map(x=>x.nome)[0] || '';
    const closeBtn = document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Fechar'; closeBtn.addEventListener('click', closePIP);
    ctrl.appendChild(title); ctrl.appendChild(closeBtn); pip.appendChild(ctrl);
    document.body.appendChild(pip); state.pip = { el:pip, idx }; // allow drag
    enableDrag(pip);
  }
  function closePIP(){ if(state.pip){ state.pip.el.remove(); state.pip=null; } }

  // drag for pip
  function enableDrag(el){ let startX, startY, origX, origY, dragging=false; el.addEventListener('pointerdown', (e)=>{ dragging=true; startX=e.clientX; startY=e.clientY; const rect=el.getBoundingClientRect(); origX=rect.right; origY=rect.bottom; el.setPointerCapture(e.pointerId); }); window.addEventListener('pointermove', (e)=>{ if(!dragging) return; const dx = startX - e.clientX; const dy = startY - e.clientY; el.style.right = (origX + dx < 12 ? 12 : origX + dx)+'px'; el.style.bottom = (origY + dy < 88 ? 88 : origY + dy)+'px'; }); window.addEventListener('pointerup', ()=>{ dragging=false; }); }

  // Large modal video (simple)
  function openModalVideo(idx){ const overlay = document.createElement('div'); overlay.style.position='fixed'; overlay.style.inset='0'; overlay.style.background='rgba(0,0,0,.6)'; overlay.style.display='grid'; overlay.style.placeItems='center'; overlay.style.zIndex=80; const v = document.createElement('video'); v.src=VIDEO_URLS[idx]||''; v.controls=true; v.autoplay=true; v.style.width='92%'; v.style.maxWidth='760px'; v.style.borderRadius='12px'; overlay.appendChild(v); overlay.addEventListener('click', (e)=>{ if(e.target===overlay){ overlay.remove(); } }); document.body.appendChild(overlay); }

  // Modal-like transitions and gestures between sections
  function initGestures(){ let touchStartX=0, touchStartY=0, touchEndX=0, touchEndY=0; const root = $('#sectionsRoot'); root.addEventListener('touchstart', (e)=>{ touchStartX = e.changedTouches[0].clientX; touchStartY = e.changedTouches[0].clientY; }, {passive:true}); root.addEventListener('touchend',(e)=>{ touchEndX = e.changedTouches[0].clientX; touchEndY = e.changedTouches[0].clientY; const dx = touchEndX - touchStartX; const dy = touchEndY - touchStartY; const absX = Math.abs(dx); const absY = Math.abs(dy); if(absX>60 && absX>absY){ if(dx<0) nextSection(); else prevSection(); } else if(dy>80 && absY>absX){ // swipe down -> close current
      closeCurrentSection(); }
    }, {passive:true}); }

  function nextSection(){ const sections = $$('.section'); state.currentSectionIndex = Math.min(sections.length-1, state.currentSectionIndex+1); openSectionAt(state.currentSectionIndex); }
  function prevSection(){ const sections = $$('.section'); state.currentSectionIndex = Math.max(0, state.currentSectionIndex-1); openSectionAt(state.currentSectionIndex); }
  function openSectionAt(i){ const secs = $$('.section'); secs.forEach((s,idx)=>{ if(idx===i) s.classList.add('open'); else s.classList.remove('open'); }); }
  function closeCurrentSection(){ const secs = $$('.section'); const cur = secs[state.currentSectionIndex]; if(cur) cur.classList.remove('open'); }

  // spotlight search
  $('#btnSearch').addEventListener('click', ()=>{ $('#searchPanel').classList.add('on'); setTimeout(()=> $('#searchInput').focus(), 120); });
  $('#searchPanel').addEventListener('click', (e)=>{ if(e.target===$('#searchPanel')) $('#searchPanel').classList.remove('on'); });
  $('#searchInput').addEventListener('input', ()=>{ const q = $('#searchInput').value.trim().toLowerCase(); $$('#sectionsRoot .workout-card').forEach(card=>{ const match = card.dataset.search.includes(q); card.style.display = match ? '' : 'none'; }); });

  // sidebar toggles
  $('#btnSidebar').addEventListener('click', ()=> $('#sidebar').classList.toggle('active'));
  document.addEventListener('click', (e)=>{ if($('#sidebar').classList.contains('active')){ if(!$('#sidebar').contains(e.target) && !$('#btnSidebar').contains(e.target)) $('#sidebar').classList.remove('active'); } });

  // reset all
  $('#btnResetAll').addEventListener('click', ()=>{ if(confirm('Limpar todos os concluídos?')){ state.done={}; persistDone(); $$('.set-bubble').forEach(b=>b.classList.remove('done')); } });

  // file inputs
  $('#formPhotoInput').addEventListener('change', ()=>{ const form = $('#photoForm'); const fd = new FormData(form); fetch(form.action, { method:'POST', body:fd }).then(()=> alert('Foto enviada!')).catch(()=> alert('Falha ao enviar.')); });
  $('#btnChangePhoto').addEventListener('click', ()=> $('#sidePhotoInput').click());
  $('#sidePhotoInput').addEventListener('change', async (e)=>{ const file = e.target.files?.[0]; if(!file) return; const data = await readFileAsDataURL(file); localStorage.setItem(LS.AVATAR, data); setAvatar(data); });
  $('#avatarInput').addEventListener('change', async (e)=>{ const file = e.target.files?.[0]; if(!file) return; const data = await readFileAsDataURL(file); localStorage.setItem(LS.AVATAR, data); setAvatar(data); });

  // bottom nav actions
  $$('.bottom-bar .nav-item').forEach(btn=> btn.addEventListener('click', ()=>{ $$('.bottom-bar .nav-item').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const tab = btn.dataset.tab; if(tab==='photo'){ $('#sidePhotoInput').click(); } if(tab==='fav'){ alert('Favoritos (demo)'); } }));

  // Open/close via sidebar quick buttons
  $('#sectionToggle_quads').addEventListener('click', ()=> openSectionByName('Treino de Quadríceps'));
  $('#sectionToggle_post').addEventListener('click', ()=> openSectionByName('Treino de Posterior e Glúteo'));
  $('#sectionToggle_push').addEventListener('click', ()=> openSectionByName('Treino de Peito, Tríceps e Bíceps'));
  $('#sectionToggle_back').addEventListener('click', ()=> openSectionByName('Treino de Ombro e Costas'));
  function openSectionByName(name){ const secs = $$('.section'); secs.forEach(s=>{ if(s.querySelector('.section-title').textContent===name){ s.classList.add('open'); state.currentSectionIndex = secs.indexOf(s); } else s.classList.remove('open'); }); }

  // Modal open/enter
  $('#btnEnter').addEventListener('click', ()=>{ document.getElementById('view-landing').style.display='none'; const a = $('#view-app'); a.classList.add('active'); state.view='app'; });

  // Init
  restoreState(); setAvatar(localStorage.getItem(LS.AVATAR)); renderSections(); initGestures();

  // Keyboard optimization: ensure inputs do not trigger layout jumps (mobile friendly)
  window.addEventListener('resize', ()=>{ document.body.style.setProperty('--vh', window.innerHeight+'px'); });

  </script>
</body>
</html>
