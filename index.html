<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PERSONAL — Cosmic Glass Preview</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      /* Light */
      --bg: radial-gradient(1200px 700px at 10% 10%, rgba(130,180,255,.25), transparent 60%),
            radial-gradient(900px 600px at 90% 30%, rgba(210,130,255,.22), transparent 60%),
            linear-gradient(180deg,#eef3ff,#f7f9ff);
      --ink: #0f1220;
      --ink-2:#69708b;
      --panel: rgba(255,255,255,.22);
      --panel-strong: rgba(255,255,255,.6);
      --stroke: rgba(40,60,120,.18);

      /* Dark */
      --bgD: radial-gradient(1200px 700px at 10% 10%, rgba(90,120,255,.18), transparent 60%),
             radial-gradient(900px 600px at 85% 25%, rgba(210,120,255,.16), transparent 60%),
             linear-gradient(180deg,#0b0e13,#0f141d);
      --inkD:#f2f5ff;
      --ink-2D:#aab3d0;
      --panelD: rgba(15,18,25,.45);
      --panelD-strong: rgba(15,18,25,.65);
      --strokeD: rgba(140,160,210,.08);

      --r: 18px;
      --t: .35s cubic-bezier(.2,.9,.2,1);

      /* Section accents */
      --quad: 200 100% 60%;       /* blue */
      --post: 160 70% 48%;        /* teal */
      --upper: 265 85% 62%;       /* purple */
      --back: 30 95% 60%;         /* orange */
    }

    *{box-sizing:border-box}
    html,body {height:100%}
    body {
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink); background: var(--bg); transition: background var(--t), color var(--t);
      overflow-x:hidden;
    }
    body.dark{ color: var(--inkD); background: var(--bgD); }

    /* STARFIELD */
    #stars { position: fixed; inset: 0; z-index: -1; filter: blur(.2px); opacity: .7; pointer-events:none; }

    /* HEADER */
    header { position: sticky; top: 0; backdrop-filter: blur(14px) saturate(1.1);
      border-bottom: 1px solid var(--stroke); z-index: 20; }
    body.dark header{ border-bottom-color: var(--strokeD); }
    .nav { display:flex; align-items:center; justify-content:space-between; gap:16px; padding: 14px clamp(14px, 4vw, 28px); }
    .brand { font-weight: 800; letter-spacing:.5px; display:flex; align-items:center; gap:12px; }
    .brand .logo { width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg,#8db2ff, #b895ff);
      box-shadow: 0 6px 18px rgba(102,130,255,.35); display:grid; place-items:center; color:white; font-weight:900 }
    .brand span { font-size: 1.1rem }

    .nav-acts { display:flex; align-items:center; gap:8px; }
    .gbtn { width:42px; height:42px; display:grid; place-items:center; border-radius:12px;
      border:1px solid var(--stroke); background: var(--panel); backdrop-filter: blur(10px) saturate(1.4); color:inherit;
      transition: transform var(--t), background var(--t), border-color var(--t), box-shadow var(--t); cursor:pointer; }
    .gbtn:hover{ transform: translateY(-2px); box-shadow: 0 8px 22px rgba(10,30,80,.12); }
    body.dark .gbtn{ border-color: var(--strokeD); background: var(--panelD); }

    /* WRAP */
    .hero { display:grid; grid-template-columns: 1fr; gap:18px; padding: clamp(14px, 4vw, 28px); }
    @media (min-width: 980px){ .hero{ grid-template-columns: 1.2fr .8fr; align-items:stretch; } }

    .stats { border:1px dashed var(--stroke); border-radius: var(--r); background:linear-gradient(120deg, rgba(255,255,255,.24), rgba(255,255,255,.14)); padding:18px; backdrop-filter: blur(10px); }
    body.dark .stats{ border-color: var(--strokeD); background: linear-gradient(120deg, rgba(15,18,25,.55), rgba(15,18,25,.35)); }
    .stats h1{ font-size: clamp(28px, 3.4vw, 44px); margin: 4px 0 10px; letter-spacing:.5px }
    .stats p { margin:0; color: var(--ink-2) }
    body.dark .stats p{ color: var(--ink-2D) }

    .week-card { border:1px solid var(--stroke); border-radius: var(--r); padding:16px; display:flex; align-items:center; gap:12px; 
      background: var(--panel); backdrop-filter: blur(10px); }
    body.dark .week-card{ border-color:var(--strokeD); background: var(--panelD); }
    .chip { padding:6px 10px; border-radius:999px; font-weight:700; font-size:.8rem; letter-spacing:.3px; background:rgba(255,255,255,.5); }
    body.dark .chip{ background: rgba(255,255,255,.08); }

    /* SECTIONS */
    .sections { padding: clamp(10px, 3.5vw, 24px); display:grid; gap:16px; }

    .section { border-radius: calc(var(--r) + 6px); overflow:hidden; border:1px solid var(--stroke); backdrop-filter: blur(10px); }
    body.dark .section{ border-color:var(--strokeD); }

    .s-head { position:relative; display:flex; align-items:center; justify-content:space-between; padding:14px 16px; font-weight:800; letter-spacing:.3px; }
    .s-head::before{ content:""; position:absolute; inset:0; opacity:.66; pointer-events:none; }
    .section[data-accent="quad"] .s-head::before{ background: linear-gradient(120deg, hsla(var(--quad)/.12), transparent 55%); }
    .section[data-accent="post"] .s-head::before{ background: linear-gradient(120deg, hsla(var(--post)/.12), transparent 55%); }
    .section[data-accent="upper"] .s-head::before{ background: linear-gradient(120deg, hsla(var(--upper)/.12), transparent 55%); }
    .section[data-accent="back"] .s-head::before{ background: linear-gradient(120deg, hsla(var(--back)/.12), transparent 55%); }

    .toggle { width:44px; height:44px; border-radius:12px; border:1px solid var(--stroke); background: var(--panel);
      display:grid; place-items:center; cursor:pointer; transform-origin:center; transition: var(--t); }
    body.dark .toggle{ border-color:var(--strokeD); background:var(--panelD); }
    .toggle i{ transition: transform .45s cubic-bezier(.2,1,.2,1); }
    .section.open .toggle i{ transform: rotate(180deg) scale(1.05); }
    .section.open .toggle{ box-shadow: 0 8px 24px rgba(40,120,255,.18); }

    .progress { height:8px; margin: 0 14px 12px; border-radius: 999px; overflow:hidden; background: rgba(0,0,0,.06); }
    body.dark .progress{ background: rgba(255,255,255,.08); }
    .bar { height: 100%; width:0; background: linear-gradient(90deg, #5aa9ff, #b58dff); transition: width .5s ease; }

    .s-body { max-height:0; overflow:hidden; transition: max-height .66s cubic-bezier(.2,.9,.2,1); }
    .section.open .s-body{ max-height: 3000px; }

    .grid { display:grid; gap:14px; padding: 0 14px 16px; }
    @media(min-width: 840px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }

    /* CARD */
    .card { position:relative; border:1px solid var(--stroke); border-radius: 16px; padding: 14px; background: var(--panel);
      backdrop-filter: blur(12px) saturate(1.45); overflow:hidden; transition: var(--t); }
    body.dark .card{ border-color: var(--strokeD); background: var(--panelD); }
    .card.reveal{ animation: slideFade .5s ease both; }
    @keyframes slideFade { from{ opacity:0; transform: translateY(8px) scale(.98); } to{ opacity:1; transform: none; } }

    .title { font-weight: 700; margin: 0 0 6px; display:flex; align-items:center; gap:10px; }
    .meta { font-size: .92rem; color: var(--ink-2); margin-bottom: 10px; }
    body.dark .meta{ color: var(--ink-2D); }

    /* Glass switch for "concluir" */
    .finish { --w: 56px; position:absolute; top: 12px; right: 12px; width: var(--w); height:30px; border-radius:999px; border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25)); display:flex; align-items:center; padding:3px; gap:6px;
      transition: var(--t); cursor:pointer; }
    body.dark .finish{ border-color:var(--strokeD); background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); }
    .knob { width:24px; height:24px; border-radius: 50%; background: white; box-shadow: 0 4px 10px rgba(0,0,0,.15); transition: var(--t); }
    body.dark .knob{ background: #e8ecff; }
    .finish .label{ font-size:.78rem; font-weight:700; opacity:.7; transition: var(--t); }
    .card.done .finish{ background: linear-gradient(180deg, rgba(120,255,180,.55), rgba(120,255,180,.25)); }
    .card.done .finish .knob{ transform: translateX(calc(var(--w) - 30px)); background: #fff; }
    .card.done .finish .label{ opacity:1 }
    .card.done{ border-color: rgba(90,220,160,.45); box-shadow: inset 0 0 0 1px rgba(90,220,160,.25); }
    .card.done::after{ content:"✅"; position:absolute; top:10px; left:12px; font-size: 1rem; opacity:.9 }

    .video { border-radius: 12px; overflow:hidden; border:1px solid var(--stroke); background:rgba(0,0,0,.08); }
    body.dark .video{ border-color:var(--strokeD); background: rgba(255,255,255,.06); }
    .video video{ width:100%; display:block; }

    /* SEARCH OVERLAY (Spotlight style) */
    .overlay{ position: fixed; inset:0; display:none; align-items:flex-start; justify-content:center; padding-top: 12vh; background: rgba(6,10,18,.4); backdrop-filter: blur(10px); z-index:50; }
    .overlay.show{ display:flex }
    .search { width:min(820px, 92vw); border:1px solid var(--stroke); background: var(--panel-strong); border-radius:14px; display:flex; padding:10px; gap:10px; align-items:center; }
    body.dark .search{ border-color:var(--strokeD); background: var(--panelD-strong); }
    .search input{ flex:1; font:inherit; border:none; outline:none; background:transparent; color:inherit; padding:10px }

    /* TOAST */
    .toast{ position: fixed; bottom:22px; left:50%; transform: translateX(-50%); padding:10px 14px; border-radius: 11px; background: rgba(30,40,60,.88); color:#fff; 
      box-shadow: 0 6px 18px rgba(0,0,0,.25); opacity:0; transition:.35s; z-index:60; }
    .toast.show{ opacity:1 }
  </style>
</head>
<body>
  <canvas id="stars"></canvas>

  <header>
    <div class="nav">
      <div class="brand"><div class="logo">P</div><span>PERSONAL</span></div>
      <div class="nav-acts">
        <button id="searchBtn" class="gbtn" title="Buscar"><i class="fa-solid fa-magnifying-glass"></i></button>
        <a class="gbtn" title="Enviar foto (Formspree)" href="https://formspree.io/f/mzzavnrq" target="_blank" rel="noopener"><i class="fa-regular fa-image"></i></a>
        <button id="modeBtn" class="gbtn" title="Modo compacto"><i class="fa-solid fa-table-list"></i></button>
        <button id="themeBtn" class="gbtn" title="Tema claro/escuro"><i class="fa-solid fa-moon"></i></button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="stats">
      <h1>Seu Treino, no Ritmo certo</h1>
      <p>Visual futurista, leve e funcional. Marque os exercícios como concluídos e acompanhe o progresso por seção.</p>
    </div>
    <div class="week-card">
      <span class="chip">Semana</span>
      <div id="weekText">🔥 0/0 exercícios concluídos</div>
    </div>
  </section>

  <div class="sections">
    <div class="section" id="sec-quad" data-accent="quad">
      <div class="s-head">
        <div>Treino de Quadríceps</div>
        <button class="toggle" aria-label="alternar"><i class="fa-solid fa-plus"></i></button>
      </div>
      <div class="progress"><div class="bar"></div></div>
      <div class="s-body"><div class="grid" data-grid="quad"></div></div>
    </div>

    <div class="section" id="sec-post" data-accent="post">
      <div class="s-head">
        <div>Posterior & Glúteo</div>
        <button class="toggle" aria-label="alternar"><i class="fa-solid fa-plus"></i></button>
      </div>
      <div class="progress"><div class="bar"></div></div>
      <div class="s-body"><div class="grid" data-grid="post"></div></div>
    </div>

    <div class="section" id="sec-upper" data-accent="upper">
      <div class="s-head">
        <div>Peito, Tríceps & Bíceps</div>
        <button class="toggle" aria-label="alternar"><i class="fa-solid fa-plus"></i></button>
      </div>
      <div class="progress"><div class="bar"></div></div>
      <div class="s-body"><div class="grid" data-grid="upper"></div></div>
    </div>

    <div class="section" id="sec-back" data-accent="back">
      <div class="s-head">
        <div>Ombro & Costas</div>
        <button class="toggle" aria-label="alternar"><i class="fa-solid fa-plus"></i></button>
      </div>
      <div class="progress"><div class="bar"></div></div>
      <div class="s-body"><div class="grid" data-grid="back"></div></div>
    </div>
  </div>

  <!-- Spotlight Search -->
  <div class="overlay" id="overlay">
    <div class="search">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input id="q" placeholder="Buscar exercício..." />
      <button class="gbtn" id="closeSearch" title="Fechar"><i class="fa-solid fa-xmark"></i></button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ==== STARFIELD (leve) ====
    const stars = document.getElementById('stars');
    const ctx = stars.getContext('2d');
    let W,H,items=[]; function resize(){ W=stars.width=innerWidth; H=stars.height=innerHeight; items = Array.from({length: Math.min(120, Math.floor(W/10))}, ()=>({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.2+0.2, s: Math.random()*0.3+0.05 })); }
    addEventListener('resize', resize); resize();
    (function loop(){ ctx.clearRect(0,0,W,H); ctx.fillStyle='rgba(255,255,255,.9)'; items.forEach(o=>{ o.y += o.s; if(o.y>H) o.y=0; ctx.beginPath(); ctx.arc(o.x,o.y,o.r,0,6.283); ctx.fill();}); requestAnimationFrame(loop); })();

    // ==== DATA (resumido para preview) ====
    const DATA = {
      quad: [
        {n:'Agachamento Sumô com Halteres', s:'3x10/10/10 (drop conta uma série)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-sumo-squat-front.mp4'},
        {n:'Leg Press 45°', s:'4x15 (pés colados) + 15 (afastados)', c:'12kg', i:'40s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-leg-press-front.mp4'},
        {n:'Adução de Quadril Máquina', s:'3x10/10/10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-adduction-front.mp4'},
        {n:'Cadeira Flexora', s:'3x10/10/10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-seated-leg-curl-side.mp4'},
        {n:'Cadeira Flexora Unilateral', s:'3x10/10/10/10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Seated_Leg_Curl_FR_1080.mp4'},
        {n:'Panturrilha no Step', s:'4x15', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-calves-stretch-variation-3-side.mp4'},
        {n:'Abdominal Canivete', s:'4x15', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-suitcase-crunch-side.mp4'},
        {n:'Esteira Caminhada', s:'30 reps', c:'', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4'}
      ],
      post: [
        {n:'Agachamento com Halteres', s:'3x10+10+10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-rack-squat-side.mp4'},
        {n:'Abdução de Quadril Máquina', s:'3x10+10+10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Machine-machine-hip-abduction-front.mp4'},
        {n:'Elíptico', s:'25 reps', c:'0kg', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-elliptical-side.mp4'},
        {n:'Afundo com Barra Livre', s:'3x12 3x10 2x8', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-barbell-reverse-lunge-side.mp4'},
        {n:'Agachamento Sumô no Step com Halteres', s:'3x10+10+10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/DB_Sumo_Squat_FR_1080.mp4'},
        {n:'Cadeira Extensora', s:'3x10+10+10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-machine-leg-extension-side.mp4'},
        {n:'Cadeira Extensora Unilateral', s:'3x10+10+10 (drop)', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Single_Leg_Extension_FR_1080.mp4'},
        {n:'Leg Press 45° Unilateral', s:'3x12 3x10 2x8', c:'0kg', i:'60s', v:'https://media.musclewiki.com/media/uploads/videos/branded/machines/_1080/Leg_Press_FR_1080.mp4'}
      ],
      upper: [
        {n:'Alongamento de Ombros e Tríceps II', s:'3x20', c:'0kg', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-shoulders-stretch-variation-1-front.mp4'},
        {n:'Bike Spinning Sentada', s:'40 reps', c:'', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-stationary-bike-side.mp4'},
        {n:'Abdominal Supra Solo', s:'5x15', c:'0kg', i:'40s', v:'https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/Crunch_FR_1080.mp4'},
        {n:'Tríceps Unilateral na Polia Alta', s:'3x15', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-single-arm-rope-pushdown-side.mp4'},
        {n:'Alongamento de Peitoral Espaldar', s:'3x15', c:'0kg', i:'40s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-chest-stretch-variation-1-side.mp4'},
        {n:'Mobilidade de Ombro III', s:'3x20', c:'0kg', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Recovery-thoracic-extensions-via-shoulder-flexion-foam-roller-front.mp4'},
        {n:'Rosca Alternada com Halteres', s:'3x15', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-curl-side.mp4'},
        {n:'Tríceps na Polia com Corda', s:'3x15 lento + 15 curto', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cables-cable-push-down-side.mp4'},
        {n:'Crucifixo com Halteres', s:'4x12', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-fly-front.mp4'},
        {n:'Crucifixo Inclinado com Halteres', s:'4x12', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-dumbbell-incline-chest-flys-side.mp4'},
        {n:'Rosca Martelo com Halteres', s:'4x12', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-hammer-curl-side.mp4'}
      ],
      back: [
        {n:'Puxada Alta (pegada neutra)', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4'},
        {n:'Abdominal Canivete', s:'3x12', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/bodyweight/_1080/V-Up_FR_1080.mp4'},
        {n:'Esteira Caminhada', s:'40 reps', c:'', i:'', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Cardio-treadmill-walk-side.mp4'},
        {n:'Elevação Lateral Unilateral Sentado', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-neutral-overhead-press-side.mp4'},
        {n:'Elevação Frontal Alternada', s:'3x12', c:'4 a 6kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-Dumbbells-dumbbell-front-raise-side.mp4'},
        {n:'Desenvolvimento com Halteres', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/dumbbells/_1080/Neutral_Grip_DB_Press_FR_1080.mp4'},
        {n:'Puxada Neutra Triângulo', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/cables/_1080/Seated_Row_V_Grip_FR_1080.mp4'},
        {n:'Remada Baixa Triângulo', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-machine-seated-cable-row-front.mp4'},
        {n:'Puxada Aberta Barra Reta', s:'3x10/8/6 (drop)', c:'0kg', i:'30s', v:'https://media.musclewiki.com/media/uploads/videos/branded/female-machine-pulldown-side.mp4'}
      ]
    };

    const grids = {
      quad: document.querySelector('[data-grid="quad"]'),
      post: document.querySelector('[data-grid="post"]'),
      upper: document.querySelector('[data-grid="upper"]'),
      back: document.querySelector('[data-grid="back"]')
    };

    function cardTemplate(sec, i, it){
      const id = `${sec}-${i}`;
      const done = localStorage.getItem('done-'+id)==='1';
      return `<article class="card ${done?'done':''}" data-id="${id}">
        <div class="finish" role="switch" aria-checked="${done}">
          <div class="knob"></div>
          <span class="label">${done?'OK':'OFF'}</span>
        </div>
        <h4 class="title">${it.n}</h4>
        <div class="meta">${it.s}${it.c?` • Carga: ${it.c}`:''}${it.i?` • Intervalo: ${it.i}`:''}</div>
        <div class="video">${it.v?`<video src="${it.v}" controls playsinline preload="none"></video>`:''}</div>
      </article>`;
    }

    function render(){
      Object.entries(DATA).forEach(([sec, arr])=>{
        const g = grids[sec];
        g.innerHTML = arr.map((it,i)=>cardTemplate(sec,i,it)).join('');
        // reveal animation stagger
        Array.from(g.children).forEach((el,idx)=>{ setTimeout(()=>el.classList.add('reveal'), 40*idx); });
        updateProgress(sec);
      });
      updateWeek();
    }

    function updateProgress(sec){
      const arr = DATA[sec];
      const done = arr.filter((_,i)=> localStorage.getItem('done-'+sec+'-'+i)==='1').length;
      const bar = document.querySelector('#sec-'+sec+' .bar');
      bar.style.width = (done/arr.length*100)+'%';
    }

    function updateWeek(){
      let total=0, done=0;
      Object.entries(DATA).forEach(([sec,arr])=>{
        total += arr.length;
        arr.forEach((_,i)=>{ if(localStorage.getItem('done-'+sec+'-'+i)==='1') done++; });
      });
      document.getElementById('weekText').textContent = `🔥 ${done}/${total} exercícios concluídos`;
      if(done===total && total>0) celebrate();
    }

    function celebrate(){
      for(let i=0;i<16;i++) setTimeout(()=>{
        const e = document.createElement('div');
        e.textContent = '🎉'; e.style.position='fixed'; e.style.left=Math.random()*100+'%'; e.style.top='-10px'; e.style.fontSize='22px'; e.style.zIndex=80;
        e.style.animation='drop 2.2s linear forwards'; document.body.appendChild(e); setTimeout(()=>e.remove(),2300);
      }, i*120);
      const st = document.createElement('style'); st.textContent='@keyframes drop{to{transform:translateY(100vh)}}'; document.head.appendChild(st);
      showToast('🏆 Semana concluída!');
    }

    function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1600); }

    // attach handlers (delegation)
    document.addEventListener('click', (e)=>{
      // toggle section
      const tBtn = e.target.closest('.toggle');
      if(tBtn){
        const sec = tBtn.closest('.section');
        sec.classList.toggle('open');
        const icon = tBtn.querySelector('i');
        icon.className = 'fa-solid ' + (sec.classList.contains('open')? 'fa-minus' : 'fa-plus');
      }

      // finish switch
      const fin = e.target.closest('.finish');
      if(fin){
        const card = fin.closest('.card');
        const id = card.dataset.id;
        const isDone = !card.classList.contains('done');
        card.classList.toggle('done');
        fin.setAttribute('aria-checked', String(isDone));
        fin.querySelector('.label').textContent = isDone? 'OK':'OFF';
        localStorage.setItem('done-'+id, isDone?'1':'0');
        const [sec] = id.split('-');
        updateProgress(sec); updateWeek();
        showToast(isDone? 'Exercício concluído ✅' : 'Exercício reaberto');
      }
    });

    // theme + compact
    document.getElementById('themeBtn').onclick = ()=>{
      document.body.classList.toggle('dark');
    };
    document.getElementById('modeBtn').onclick = ()=>{
      document.body.classList.toggle('compact');
      document.getElementById('modeBtn').innerHTML = document.body.classList.contains('compact')? '<i class="fa-solid fa-cards-blank"></i>' : '<i class="fa-solid fa-table-list"></i>';
      document.querySelectorAll('video').forEach(v=>{ try{ v.pause(); }catch{} });
    };

    // Search overlay
    const overlay = document.getElementById('overlay');
    const q = document.getElementById('q');
    document.getElementById('searchBtn').onclick = ()=>{ overlay.classList.add('show'); q.focus(); };
    document.getElementById('closeSearch').onclick = ()=> overlay.classList.remove('show');
    overlay.addEventListener('click',(e)=>{ if(e.target===overlay) overlay.classList.remove('show'); });
    q.addEventListener('input', ()=>{
      const val = q.value.toLowerCase();
      document.querySelectorAll('.card').forEach(c=>{
        const t = c.querySelector('.title').textContent.toLowerCase();
        c.style.outline = val && t.includes(val) ? '2px solid rgba(120,160,255,.6)' : '';
      });
    });

    // open sections collapsed by default; user can open
    // render content now
    render();
  </script>
</body>
</html>
